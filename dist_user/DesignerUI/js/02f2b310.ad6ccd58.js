(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["02f2b310"],{"21a6":function(t,e,n){(function(n){var i,s,o;(function(n,r){s=[],i=r,o="function"===typeof i?i.apply(e,s):i,void 0===o||(t.exports=o)})(0,function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function i(t,e,n){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){a(i.response,e,n)},i.onerror=function(){console.error("could not download file")},i.send()}function s(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(i){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(t,e,n){var a=r.URL||r.webkitURL,l=document.createElement("a");e=e||t.name||"download",l.download=e,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?o(l):s(l.href)?i(t,e,n):o(l,l.target="_blank")):(l.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(l.href)},4e4),setTimeout(function(){o(l)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,r){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,r),n);else if(s(t))i(t,n,r);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){o(a)})}}:function(t,e,n,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return i(t,e,n);var o="application/octet-stream"===t.type,a=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&a)&&"object"==typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},u.readAsDataURL(t)}else{var h=r.URL||r.webkitURL,c=h.createObjectURL(t);s?s.location=c:location.href=c,s=null,setTimeout(function(){h.revokeObjectURL(c)},4e4)}});r.saveAs=a.saveAs=a,t.exports=a})}).call(this,n("c8ba"))},"37c8":function(t,e,n){e.f=n("2b4c")},"3a72":function(t,e,n){var i=n("7726"),s=n("8378"),o=n("2d00"),r=n("37c8"),a=n("86cc").f;t.exports=function(t){var e=s.Symbol||(s.Symbol=o?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||a(e,t,{value:r.f(t)})}},"67ab":function(t,e,n){var i=n("ca5a")("meta"),s=n("d3f4"),o=n("69a8"),r=n("86cc").f,a=0,l=Object.isExtensible||function(){return!0},u=!n("79e5")(function(){return l(Object.preventExtensions({}))}),h=function(t){r(t,i,{value:{i:"O"+ ++a,w:{}}})},c=function(t,e){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,i)){if(!l(t))return"F";if(!e)return"E";h(t)}return t[i].i},p=function(t,e){if(!o(t,i)){if(!l(t))return!0;if(!e)return!1;h(t)}return t[i].w},d=function(t){return u&&_.NEED&&l(t)&&!o(t,i)&&h(t),t},_=t.exports={KEY:i,NEED:!1,fastKey:c,getWeak:p,onFreeze:d}},"6e14":function(module,exports,__webpack_require__){(function(process){(function(t){var e=t.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:170,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#e6f4eb",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"rgba(35,35,35,0.99)",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#f4511e",NODE_DEFAULT_BGCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_BOXCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},searchbox_extras:{},registerNodeType:function(t,n){if(!n.prototype)throw"Cannot register a simple object, it must be a class with a prototype";n.type=t,e.debug&&console.log("Node registered: "+t);t.split("/");var i=n.name,o=t.lastIndexOf("/");if(n.category=t.substr(0,o),n.title||(n.title=i),n.prototype)for(var r in s.prototype)n.prototype[r]||(n.prototype[r]=s.prototype[r]);Object.defineProperty(n.prototype,"shape",{set:function(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=e.BOX_SHAPE;break;case"round":this._shape=e.ROUND_SHAPE;break;case"circle":this._shape=e.CIRCLE_SHAPE;break;case"card":this._shape=e.CARD_SHAPE;break;default:this._shape=t}},get:function(t){return this._shape},enumerable:!0});var a=this.registered_node_types[t];if(this.registered_node_types[t]=n,n.constructor.name&&(this.Nodes[i]=n),e.onNodeTypeRegistered&&e.onNodeTypeRegistered(t,n),a&&e.onNodeTypeReplaced&&e.onNodeTypeReplaced(t,n,a),n.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),n.supported_extensions)for(var r in n.supported_extensions)this.node_types_by_file_extension[n.supported_extensions[r].toLowerCase()]=n},wrapFunctionAsNode:function(t,n,i,s,o){for(var r=Array(n.length),a="",l=e.getParameterNames(n),u=0;u<l.length;++u)a+="this.addInput('"+l[u]+"',"+(i&&i[u]?"'"+i[u]+"'":"0")+");\n";a+="this.addOutput('out',"+(s?"'"+s+"'":0)+");\n",o&&(a+="this.properties = "+JSON.stringify(o)+";\n");var h=Function(a);h.title=t.split("/").pop(),h.desc="Generated from "+n.name,h.prototype.onExecute=function(){for(var t=0;t<r.length;++t)r[t]=this.getInputData(t);var e=n.apply(this,r);this.setOutputData(0,e)},this.registerNodeType(t,h)},addNodeMethod:function(t,e){for(var n in s.prototype[t]=e,this.registered_node_types){var i=this.registered_node_types[n];i.prototype[t]&&(i.prototype["_"+t]=i.prototype[t]),i.prototype[t]=e}},createNode:function(t,n,i){var s=this.registered_node_types[t];if(!s)return e.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;s.prototype;n=n||s.title||t;var o=null;if(e.catch_exceptions)try{o=new s(n)}catch(a){return console.error(a),null}else o=new s(n);if(o.type=t,!o.title&&n&&(o.title=n),o.properties||(o.properties={}),o.properties_info||(o.properties_info=[]),o.flags||(o.flags={}),o.size||(o.size=o.computeSize()),o.pos||(o.pos=e.DEFAULT_POSITION.concat()),o.mode||(o.mode=e.ALWAYS),i)for(var r in i)o[r]=i[r];return o},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var n=[];for(var i in this.registered_node_types){var s=this.registered_node_types[i];e&&s.filter&&s.filter!=e||(""==t?null==s.category&&n.push(s):s.category==t&&n.push(s))}return n},getNodeTypesCategories:function(){var t={"":1};for(var e in this.registered_node_types)this.registered_node_types[e].category&&!this.registered_node_types[e].skip_list&&(t[this.registered_node_types[e].category]=1);var n=[];for(var e in t)n.push(e);return n},reloadNodes:function(t){var n=document.getElementsByTagName("script"),i=[];for(var s in n)i.push(n[s]);var o=document.getElementsByTagName("head")[0];for(var s in t=document.location.href+t,i){var r=i[s].src;if(r&&r.substr(0,t.length)==t)try{e.debug&&console.log("Reloading: "+r);var a=document.createElement("script");a.type="text/javascript",a.src=r,o.appendChild(a),o.removeChild(i[s])}catch(l){if(e.throw_errors)throw l;e.debug&&console.log("Error while reloading "+r)}}e.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(null==t)return null;var n=JSON.parse(JSON.stringify(t));if(!e)return n;for(var i in n)e[i]=n[i];return e},isValidConnection:function(t,n){if(!t||!n||t==n||t==e.EVENT&&n==e.ACTION)return!0;if(t=String(t),n=String(n),t=t.toLowerCase(),n=n.toLowerCase(),-1==t.indexOf(",")&&-1==n.indexOf(","))return t==n;for(var i=t.split(","),s=n.split(","),o=0;o<i.length;++o)for(var r=0;r<s.length;++r)if(i[o]==s[r])return!0;return!1},registerSearchboxExtra:function(t,e,n){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:n}}};function n(t){e.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}function i(t,e,n,i,s,o){this.id=t,this.type=e,this.origin_id=n,this.origin_slot=i,this.target_id=s,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}function s(t){this._ctor(t)}function o(t){this._ctor(t)}function r(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}function a(t,n,i){i=i||{},this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new r,this.zoom_modify_alpha=!0,this.title_text_font=e.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+e.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=e.NODE_TITLE_COLOR,this.default_link_color=e.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.allow_searchbox=!0,this.allow_reconnect_links=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.links_render_mode=e.SPLINE_LINK,this.canvas_mouse=[0,0],this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],n&&n.attachCanvas(this),this.setCanvas(t),this.clear(),i.skip_render||this.startRendering(),this.autoresize=i.autoresize}"undefined"!=typeof performance?e.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?e.getTime=Date.now.bind(Date):e.getTime="undefined"!=typeof process?function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:function(){return(new Date).getTime()},t.LGraph=e.LGraph=n,n.supported_types=["number","string","boolean"],n.prototype.getSupportedTypes=function(){return this.supported_types||n.supported_types},n.STATUS_STOPPED=1,n.STATUS_RUNNING=2,n.prototype.clear=function(){if(this.stop(),this.status=n.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},n.prototype.attachCanvas=function(t){if(t.constructor!=a)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},n.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);-1!=e&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},n.prototype.start=function(t){if(this.status!=n.STATUS_RUNNING){this.status=n.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=e.getTime(),this.last_update_time=this.starttime,t=t||0;var i=this;if(0==t&&"undefined"!=typeof window&&window.requestAnimationFrame){function s(){-1==i.execution_timer_id&&(window.requestAnimationFrame(s),i.runStep(1,!this.catch_errors))}this.execution_timer_id=-1,s()}else i.runStep(1,!this.catch_errors)}},n.prototype.stop=function(){this.status!=n.STATUS_STOPPED&&(this.status=n.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},n.prototype.runStep=function(t,n,i){t=t||1;var s=e.getTime();this.globaltime=.001*(s-this.starttime);var o=this._nodes_executable?this._nodes_executable:this._nodes;if(o){if(i=i||o.length,n){for(var r=0;r<t;r++){for(var a=0;a<i;++a){var l=o[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(r=0;r<t;r++){for(a=0;a<i;++a){l=o[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(c){if(this.errors_in_execution=!0,e.throw_errors)throw c;e.debug&&console.log("Error during execution: "+c),this.stop()}var u=e.getTime(),h=u-s;0==h&&(h=1),this.execution_time=.001*h,this.globaltime+=.001*h,this.iteration+=1,this.elapsed_time=.001*(u-this.last_update_time),this.last_update_time=u}},n.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},n.prototype.computeExecutionOrder=function(t,n){for(var i=[],s=[],o={},r={},a={},l=0,u=this._nodes.length;l<u;++l){var h=this._nodes[l];if(!t||h.onExecute){o[h.id]=h;var c=0;if(h.inputs)for(var p=0,d=h.inputs.length;p<d;p++)h.inputs[p]&&null!=h.inputs[p].link&&(c+=1);0==c?(s.push(h),n&&(h._level=1)):(n&&(h._level=0),a[h.id]=c)}}while(1){if(0==s.length)break;h=s.shift();if(i.push(h),delete o[h.id],h.outputs)for(l=0;l<h.outputs.length;l++){var _=h.outputs[l];if(null!=_&&null!=_.links&&0!=_.links.length)for(p=0;p<_.links.length;p++){var g=_.links[p],f=this.links[g];if(f&&!r[f.id]){var v=this.getNodeById(f.target_id);null!=v?(n&&(!v._level||v._level<=h._level)&&(v._level=h._level+1),r[f.id]=!0,a[v.id]-=1,0==a[v.id]&&s.push(v)):r[f.id]=!0}}}}for(var l in o)i.push(o[l]);i.length!=this._nodes.length&&e.debug&&console.warn("something went wrong, nodes missing");for(u=i.length,l=0;l<u;++l)i[l].order=l;i=i.sort(function(t,e){var n=t.constructor.priority||t.priority||0,i=e.constructor.priority||e.priority||0;return n==i?t.order-e.order:n-i});for(l=0;l<u;++l)i[l].order=l;return i},n.prototype.getAncestors=function(t){var e=[],n=[t],i={};while(n.length){var s=n.shift();if(s.inputs){i[s.id]||s==t||(i[s.id]=!0,e.push(s));for(var o=0;o<s.inputs.length;++o){var r=s.getInputNode(o);r&&-1==e.indexOf(r)&&n.push(r)}}}return e.sort(function(t,e){return t.order-e.order}),e},n.prototype.arrange=function(t){t=t||40;for(var e=this.computeExecutionOrder(!1,!0),n=[],i=0;i<e.length;++i){var s=e[i],o=s._level||1;n[o]||(n[o]=[]),n[o].push(s)}var r=t;for(i=0;i<n.length;++i){var a=n[i];if(a){for(var l=100,u=t,h=0;h<a.length;++h){s=a[h];s.pos[0]=r,s.pos[1]=u,s.size[0]>l&&(l=s.size[0]),u+=s.size[1]+t}r+=l+t}}this.setDirtyCanvas(!0,!0)},n.prototype.getTime=function(){return this.globaltime},n.prototype.getFixedTime=function(){return this.fixedtime},n.prototype.getElapsedTime=function(){return this.elapsed_time},n.prototype.sendEventToAllNodes=function(t,n,i){i=i||e.ALWAYS;var s=this._nodes_in_order?this._nodes_in_order:this._nodes;if(s)for(var o=0,r=s.length;o<r;++o){var a=s[o];a.constructor!==e.Subgraph||"onExecute"==t?a[t]&&a.mode==i&&(void 0===n?a[t]():n&&n.constructor===Array?a[t].apply(a,n):a[t](n)):a.mode==i&&a.sendEventToAllNodes(t,n,i)}},n.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var i=this.list_of_graphcanvas[n];i[t]&&i[t].apply(i,e)}},n.prototype.add=function(t,n){if(t){if(t.constructor===o)return this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,void this._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),t.id=++this.last_node_id),this._nodes.length>=e.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return null==t.id||-1==t.id?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),n||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},n.prototype.remove=function(t){if(t.constructor===e.LGraphGroup){var n=this._groups.indexOf(t);return-1!=n&&this._groups.splice(n,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[t.id]&&!t.ignore_remove){if(t.inputs)for(var i=0;i<t.inputs.length;i++){var s=t.inputs[i];null!=s.link&&t.disconnectInput(i)}if(t.outputs)for(i=0;i<t.outputs.length;i++){s=t.outputs[i];null!=s.links&&s.links.length&&t.disconnectOutput(i)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(i=0;i<this.list_of_graphcanvas.length;++i){var o=this.list_of_graphcanvas[i];o.selected_nodes[t.id]&&delete o.selected_nodes[t.id],o.node_dragged==t&&(o.node_dragged=null)}var r=this._nodes.indexOf(t);-1!=r&&this._nodes.splice(r,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},n.prototype.getNodeById=function(t){return null==t?null:this._nodes_by_id[t]},n.prototype.findNodesByClass=function(t,e){e=e||[],e.length=0;for(var n=0,i=this._nodes.length;n<i;++n)this._nodes[n].constructor===t&&e.push(this._nodes[n]);return e},n.prototype.findNodesByType=function(t,e){t=t.toLowerCase();e=e||[],e.length=0;for(var n=0,i=this._nodes.length;n<i;++n)this._nodes[n].type.toLowerCase()==t&&e.push(this._nodes[n]);return e},n.prototype.findNodeByTitle=function(t){for(var e=0,n=this._nodes.length;e<n;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},n.prototype.findNodesByTitle=function(t){for(var e=[],n=0,i=this._nodes.length;n<i;++n)this._nodes[n].title==t&&e.push(this._nodes[n]);return e},n.prototype.getNodeOnPos=function(t,e,n,i){n=n||this._nodes;for(var s=n.length-1;s>=0;s--){var o=n[s];if(o.isPointInside(t,e,i))return o}return null},n.prototype.getGroupOnPos=function(t,e){for(var n=this._groups.length-1;n>=0;n--){var i=this._groups[n];if(i.isPointInside(t,e,2,!0))return i}return null},n.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var n=this._nodes[t],i=e.registered_node_types[n.type];if(n.constructor!=i){console.log("node being replaced by newer version: "+n.type);var s=e.createNode(n.type);!0,this._nodes[t]=s,s.configure(n.serialize()),s.graph=this,this._nodes_by_id[s.id]=s,n.inputs&&(s.inputs=n.inputs.concat()),n.outputs&&(s.outputs=n.outputs.concat())}}this.updateExecutionOrder()},n.prototype.onAction=function(t,n){this._input_nodes=this.findNodesByClass(e.GraphInput,this._input_nodes);for(var i=0;i<this._input_nodes.length;++i){var s=this._input_nodes[i];if(s.properties.name==t){s.onAction(t,n);break}}},n.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},n.prototype.addInput=function(t,e,n){var i=this.inputs[t];i||(this.inputs[t]={name:t,type:e,value:n},this._version++,this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},n.prototype.setInputData=function(t,e){var n=this.inputs[t];n&&(n.value=e)},n.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},n.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},n.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},n.prototype.removeInput=function(t){return!!this.inputs[t]&&(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},n.prototype.addOutput=function(t,e,n){this.outputs[t]={name:t,type:e,value:n},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},n.prototype.setOutputData=function(t,e){var n=this.outputs[t];n&&(n.value=e)},n.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},n.prototype.renameOutput=function(t,e){return!!this.outputs[t]&&(this.outputs[e]?(console.error("there is already one output with that name"),!1):(this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),void(this.onInputsOutputsChange&&this.onInputsOutputsChange())))},n.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},n.prototype.removeOutput=function(t){return!!this.outputs[t]&&(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},n.prototype.triggerInput=function(t,e){for(var n=this.findNodesByTitle(t),i=0;i<n.length;++i)n[i].onTrigger(e)},n.prototype.setCallback=function(t,e){for(var n=this.findNodesByTitle(t),i=0;i<n.length;++i)n[i].setTrigger(e)},n.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},n.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},n.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&(e._last_time&&(e._last_time=0))}},n.prototype.change=function(){e.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},n.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},n.prototype.removeLink=function(t){var e=this.links[t];if(e){var n=this.getNodeById(e.target_id);n&&n.disconnectInput(e.target_slot)}},n.prototype.serialize=function(){for(var t=[],n=0,s=this._nodes.length;n<s;++n)t.push(this._nodes[n].serialize());var o=[];for(var n in this.links){var r=this.links[n];if(!r.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var a=new i;for(var n in r)a[n]=r[n];this.links[n]=a,r=a}o.push(r.serialize())}var l=[];for(n=0;n<this._groups.length;++n)l.push(this._groups[n].serialize());var u={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:o,groups:l,config:this.config,version:e.VERSION};return u},n.prototype.configure=function(t,n){if(t){n||this.clear();var o=t.nodes;if(t.links&&t.links.constructor===Array){for(var r=[],a=0;a<t.links.length;++a){var l=t.links[a],u=new i;u.configure(l),r[u.id]=u}t.links=r}for(var a in t)this[a]=t[a];var h=!1;if(this._nodes=[],o){a=0;for(var c=o.length;a<c;++a){var p=o[a],d=e.createNode(p.type,p.title);d||(e.debug&&console.log("Node not found or has errors: "+p.type),d=new s,d.last_serialization=p,d.has_errors=!0,h=!0),d.id=p.id,this.add(d,!0)}for(a=0,c=o.length;a<c;++a){p=o[a],d=this.getNodeById(p.id);d&&d.configure(p)}}if(this._groups.length=0,t.groups)for(a=0;a<t.groups.length;++a){var _=new e.LGraphGroup;_.configure(t.groups[a]),this.add(_)}return this.updateExecutionOrder(),this._version++,this.setDirtyCanvas(!0,!0),h}},n.prototype.load=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.send(null),n.onload=function(t){if(200===n.status){var i=JSON.parse(n.response);e.configure(i)}else console.error("Error loading graph:",n.status,n.response)},n.onerror=function(t){console.error("Error loading graph:",t)}},n.prototype.onNodeTrace=function(t,e,n){},i.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},i.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},e.LLink=i,t.LGraphNode=e.LGraphNode=s,s.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[e.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},s.prototype.configure=function(t){for(var n in this.graph&&this.graph._version++,t)if("properties"!=n)null!=t[n]&&("object"==typeof t[n]?this[n]&&this[n].configure?this[n].configure(t[n]):this[n]=e.cloneObject(t[n],this[n]):this[n]=t[n]);else for(var i in t.properties)this.properties[i]=t.properties[i],this.onPropertyChanged&&this.onPropertyChanged(i,t.properties[i]);if(t.title||(this.title=this.constructor.title),this.onConnectionsChange){if(this.inputs)for(var s=0;s<this.inputs.length;++s){var o=this.inputs[s],r=this.graph?this.graph.links[o.link]:null;this.onConnectionsChange(e.INPUT,s,!0,r,o)}if(this.outputs)for(s=0;s<this.outputs.length;++s){var a=this.outputs[s];if(a.links)for(n=0;n<a.links.length;++n){r=this.graph?this.graph.links[a.links[n]]:null;this.onConnectionsChange(e.OUTPUT,s,!0,r,a)}}}if(t.widgets_values&&this.widgets)for(s=0;s<t.widgets_values.length;++s)this.widgets[s]&&(this.widgets[s].value=t.widgets_values[s]);this.onConfigure&&this.onConfigure(t)},s.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:e.cloneObject(this.flags),mode:this.mode};if(this.constructor===s&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var n=0;n<this.outputs.length;n++)delete this.outputs[n]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=e.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(n=0;n<this.widgets.length;++n)t.widgets_values[n]=this.widgets[n].value}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},s.prototype.clone=function(){var t=e.createNode(this.type);if(!t)return null;var n=e.cloneObject(this.serialize());if(n.inputs)for(var i=0;i<n.inputs.length;++i)n.inputs[i].link=null;if(n.outputs)for(i=0;i<n.outputs.length;++i)n.outputs[i].links&&(n.outputs[i].links.length=0);return delete n["id"],t.configure(n),t},s.prototype.toString=function(){return JSON.stringify(this.serialize())},s.prototype.getTitle=function(){return this.title||this.constructor.title},s.prototype.setProperty=function(t,e){this.properties||(this.properties={}),this.properties[t]=e,this.onPropertyChanged&&this.onPropertyChanged(t,e)},s.prototype.setOutputData=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n._data=e,this.outputs[t].links))for(var i=0;i<this.outputs[t].links.length;i++){var s=this.outputs[t].links[i];this.graph.links[s].data=e}}},s.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n.type=e,this.outputs[t].links))for(var i=0;i<this.outputs[t].links.length;i++){var s=this.outputs[t].links[i];this.graph.links[s].type=e}}},s.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||null==this.inputs[t].link)){var n=this.inputs[t].link,i=this.graph.links[n];if(!i)return null;if(!e)return i.data;var s=this.graph.getNodeById(i.origin_id);return s?(s.updateOutputData?s.updateOutputData(i.origin_slot):s.onExecute&&s.onExecute(),i.data):i.data}},s.prototype.getInputDataType=function(t){if(!this.inputs)return null;if(t>=this.inputs.length||null==this.inputs[t].link)return null;var e=this.inputs[t].link,n=this.graph.links[e];if(!n)return null;var i=this.graph.getNodeById(n.origin_id);if(!i)return n.type;var s=i.outputs[n.origin_slot];return s?s.type:null},s.prototype.getInputDataByName=function(t,e){var n=this.findInputSlot(t);return-1==n?null:this.getInputData(n,e)},s.prototype.isInputConnected=function(t){return!!this.inputs&&(t<this.inputs.length&&null!=this.inputs[t].link)},s.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},s.prototype.getInputNode=function(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||null===e.link)return null;var n=this.graph.links[e.link];return n?this.graph.getNodeById(n.origin_id):null},s.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,n=this.inputs.length;e<n;++e){var i=this.inputs[e];if(t==i.name&&null!=i.link){var s=this.graph.links[i.link];if(s)return s.data}}return this.properties[t]},s.prototype.getOutputData=function(t){if(!this.outputs)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},s.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},s.prototype.isOutputConnected=function(t){return!!this.outputs&&(t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length)},s.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},s.prototype.getOutputNodes=function(t){if(!this.outputs||0==this.outputs.length)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||0==e.links.length)return null;for(var n=[],i=0;i<e.links.length;i++){var s=e.links[i],o=this.graph.links[s];if(o){var r=this.graph.getNodeById(o.target_id);r&&n.push(r)}}return n},s.prototype.trigger=function(t,n){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var i=0;i<this.outputs.length;++i){var s=this.outputs[i];!s||s.type!==e.EVENT||t&&s.name!=t||this.triggerSlot(i,n)}}},s.prototype.triggerSlot=function(t,n,i){if(this.outputs){var s=this.outputs[t];if(s){var o=s.links;if(o&&o.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var r=0;r<o.length;++r){var a=o[r];if(null==i||i==a){var l=this.graph.links[o[r]];if(l){l._last_time=e.getTime();var u=this.graph.getNodeById(l.target_id);if(u){var h=u.inputs[l.target_slot];u.onAction?u.onAction(h.name,n):u.mode===e.ON_TRIGGER&&u.onExecute&&u.onExecute(n)}}}}}}}},s.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var n=this.outputs[t];if(n){var i=n.links;if(i&&i.length)for(var s=0;s<i.length;++s){var o=i[s];if(null==e||e==o){var r=this.graph.links[i[s]];r&&(r._last_time=0)}}}}},s.prototype.addProperty=function(t,e,n,i){var s={name:t,type:n,default_value:e};if(i)for(var o in i)s[o]=i[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(s),this.properties||(this.properties={}),this.properties[t]=e,s},s.prototype.addOutput=function(t,e,n){var i={name:t,type:e,links:null};if(n)for(var s in n)i[s]=n[s];return this.outputs||(this.outputs=[]),this.outputs.push(i),this.onOutputAdded&&this.onOutputAdded(i),this.size=this.computeSize(),this.setDirtyCanvas(!0,!0),i},s.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],i={name:n[0],type:n[1],link:null};if(t[2])for(var s in n[2])i[s]=n[2][s];this.outputs||(this.outputs=[]),this.outputs.push(i),this.onOutputAdded&&this.onOutputAdded(i)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},s.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(this.outputs[e]&&this.outputs[e].links)for(var n=this.outputs[e].links,i=0;i<n.length;++i){var s=this.graph.links[n[i]];s&&(s.origin_slot-=1)}this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},s.prototype.addInput=function(t,e,n){e=e||0;var i={name:t,type:e,link:null};if(n)for(var s in n)i[s]=n[s];return this.inputs||(this.inputs=[]),this.inputs.push(i),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(i),this.setDirtyCanvas(!0,!0),i},s.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],i={name:n[0],type:n[1],link:null};if(t[2])for(var s in n[2])i[s]=n[2][s];this.inputs||(this.inputs=[]),this.inputs.push(i),this.onInputAdded&&this.onInputAdded(i)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},s.prototype.removeInput=function(t){this.disconnectInput(t),this.inputs.splice(t,1);for(var e=t;e<this.inputs.length;++e)if(this.inputs[e]){var n=this.graph.links[this.inputs[e].link];n&&(n.target_slot-=1)}this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t),this.setDirtyCanvas(!0,!0)},s.prototype.addConnection=function(t,e,n,i){var s={name:t,type:e,pos:n,direction:i,links:null};return this.connections.push(s),s},s.prototype.computeSize=function(t,n){if(this.constructor.size)return this.constructor.size.concat();var i=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),s=n||new Float32Array([0,0]);i=Math.max(i,1);var o=e.NODE_TEXT_SIZE;s[1]=(this.constructor.slot_start_y||0)+i*e.NODE_SLOT_HEIGHT;var r=0;this.widgets&&this.widgets.length&&(r=this.widgets.length*(e.NODE_WIDGET_HEIGHT+4)+8),this.widgets_up?s[1]=Math.max(s[1],r):s[1]+=r;o=o;var a=f(this.title),l=0,u=0;if(this.inputs)for(var h=0,c=this.inputs.length;h<c;++h){var p=this.inputs[h],d=p.label||p.name||"",_=f(d);l<_&&(l=_)}if(this.outputs)for(h=0,c=this.outputs.length;h<c;++h){var g=this.outputs[h];d=g.label||g.name||"",_=f(d);u<_&&(u=_)}function f(t){return t?o*t.length*.6:0}return s[0]=Math.max(l+u+10,a),s[0]=Math.max(s[0],e.NODE_WIDTH),this.widgets&&this.widgets.length&&(s[0]=Math.max(s[0],1.5*e.NODE_WIDTH)),this.onResize&&this.onResize(s),this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s},s.prototype.addWidget=function(t,e,n,i,s){this.widgets||(this.widgets=[]);var o={type:t.toLowerCase(),name:e,value:n,callback:i,options:s||{}};if(void 0!==o.options.y&&(o.y=o.options.y),i||console.warn("LiteGraph addWidget(...) without a callback"),"combo"==t&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),o},s.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},s.prototype.getBounding=function(t){return t=t||new Float32Array(4),t[0]=this.pos[0]-4,t[1]=this.pos[1]-e.NODE_TITLE_HEIGHT,t[2]=this.size[0]+4,t[3]=this.size[1]+e.NODE_TITLE_HEIGHT,this.onBounding&&this.onBounding(t),t},s.prototype.isPointInside=function(t,n,i,s){i=i||0;var o=this.graph&&this.graph.isLive()?0:e.NODE_TITLE_HEIGHT;if(s&&(o=0),this.flags&&this.flags.collapsed){if(m(t,n,this.pos[0]-i,this.pos[1]-e.NODE_TITLE_HEIGHT-i,(this._collapsed_width||e.NODE_COLLAPSED_WIDTH)+2*i,e.NODE_TITLE_HEIGHT+2*i))return!0}else if(this.pos[0]-4-i<t&&this.pos[0]+this.size[0]+4+i>t&&this.pos[1]-o-i<n&&this.pos[1]+this.size[1]+i>n)return!0;return!1},s.prototype.getSlotInPosition=function(t,e){var n=new Float32Array(2);if(this.inputs)for(var i=0,s=this.inputs.length;i<s;++i){var o=this.inputs[i];if(this.getConnectionPos(!0,i,n),m(t,e,n[0]-10,n[1]-5,20,10))return{input:o,slot:i,link_pos:n}}if(this.outputs)for(i=0,s=this.outputs.length;i<s;++i){var r=this.outputs[i];if(this.getConnectionPos(!1,i,n),m(t,e,n[0]-10,n[1]-5,20,10))return{output:r,slot:i,link_pos:n}}return null},s.prototype.findInputSlot=function(t){if(!this.inputs)return-1;for(var e=0,n=this.inputs.length;e<n;++e)if(t==this.inputs[e].name)return e;return-1},s.prototype.findOutputSlot=function(t){if(!this.outputs)return-1;for(var e=0,n=this.outputs.length;e<n;++e)if(t==this.outputs[e].name)return e;return-1},s.prototype.connect=function(t,n,s){if(s=s||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null;if(n&&n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw"target node is null";if(n==this)return null;if(s.constructor===String){if(s=n.findInputSlot(s),-1==s)return e.debug&&console.log("Connect: Error, no slot of name "+s),null}else{if(s===e.EVENT)return null;if(!n.inputs||s>=n.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null}null!=n.inputs[s].link&&n.disconnectInput(s);var o=this.outputs[t];if(n.onConnectInput&&!1===n.onConnectInput(s,o.type,o))return null;var r=n.inputs[s],a=null;return e.isValidConnection(o.type,r.type)&&(a=new i(this.graph.last_link_id++,r.type,this.id,t,n.id,s),this.graph.links[a.id]=a,null==o.links&&(o.links=[]),o.links.push(a.id),n.inputs[s].link=a.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!0,a,o),n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,s,!0,a,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.INPUT,n,s,this,t),this.graph.onNodeConnectionChange(e.OUTPUT,this,t,n,s))),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this,a),a},s.prototype.disconnectOutput=function(t,n){if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var i=this.outputs[t];if(!i||!i.links||0==i.links.length)return!1;if(n){if(n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw"Target Node not found";for(var s=0,o=i.links.length;s<o;s++){var r=i.links[s],a=this.graph.links[r];if(a.target_id==n.id){i.links.splice(s,1);var l=n.inputs[a.target_slot];l.link=null,delete this.graph.links[r],this.graph&&this.graph._version++,n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,a.target_slot,!1,a,l),this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,a,i),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,n,a.target_slot));break}}}else{for(s=0,o=i.links.length;s<o;s++){r=i.links[s],a=this.graph.links[r];if(a){n=this.graph.getNodeById(a.target_id),l=null;this.graph&&this.graph._version++,n&&(l=n.inputs[a.target_slot],l.link=null,n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,a.target_slot,!1,a,l),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.INPUT,n,a.target_slot)),delete this.graph.links[r],this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,a,i),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,n,a.target_slot))}}i.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},s.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.inputs[t];if(!n)return!1;var i=this.inputs[t].link;this.inputs[t].link=null;var s=this.graph.links[i];if(s){var o=this.graph.getNodeById(s.origin_id);if(!o)return!1;var r=o.outputs[s.origin_slot];if(!r||!r.links||0==r.links.length)return!1;for(var a=0,l=r.links.length;a<l;a++)if(r.links[a]==i){r.links.splice(a,1);break}delete this.graph.links[i],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.INPUT,t,!1,s,n),o.onConnectionsChange&&o.onConnectionsChange(e.OUTPUT,a,!1,s,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,o,a),this.graph.onNodeConnectionChange(e.INPUT,this,t))}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},s.prototype.getConnectionPos=function(t,n,i){i=i||new Float32Array(2);var s=0;t&&this.inputs&&(s=this.inputs.length),!t&&this.outputs&&(s=this.outputs.length);var o=.5*e.NODE_SLOT_HEIGHT;if(this.flags.collapsed){var r=this._collapsed_width||e.NODE_COLLAPSED_WIDTH;return this.horizontal?(i[0]=this.pos[0]+.5*r,i[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]):(i[0]=t?this.pos[0]:this.pos[0]+r,i[1]=this.pos[1]-.5*e.NODE_TITLE_HEIGHT),i}return t&&-1==n?(i[0]=this.pos[0]+.5*e.NODE_TITLE_HEIGHT,i[1]=this.pos[1]+.5*e.NODE_TITLE_HEIGHT,i):t&&s>n&&this.inputs[n].pos?(i[0]=this.pos[0]+this.inputs[n].pos[0],i[1]=this.pos[1]+this.inputs[n].pos[1],i):!t&&s>n&&this.outputs[n].pos?(i[0]=this.pos[0]+this.outputs[n].pos[0],i[1]=this.pos[1]+this.outputs[n].pos[1],i):this.horizontal?(i[0]=this.pos[0]+(n+.5)*(this.size[0]/s),i[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1],i):(i[0]=t?this.pos[0]+o:this.pos[0]+this.size[0]+1-o,i[1]=this.pos[1]+(n+.7)*e.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),i)},s.prototype.alignToGrid=function(){this.pos[0]=e.CANVAS_GRID_SIZE*Math.round(this.pos[0]/e.CANVAS_GRID_SIZE),this.pos[1]=e.CANVAS_GRID_SIZE*Math.round(this.pos[1]/e.CANVAS_GRID_SIZE)},s.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>s.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,t)},s.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},s.prototype.loadImage=function(t){var n=new Image;n.src=e.node_images_path+t,n.ready=!1;var i=this;return n.onload=function(){this.ready=!0,i.setDirtyCanvas(!0)},n},s.prototype.captureInput=function(t){if(this.graph&&this.graph.list_of_graphcanvas)for(var e=this.graph.list_of_graphcanvas,n=0;n<e.length;++n){var i=e[n];(t||i.node_capturing_input==this)&&(i.node_capturing_input=t?this:null)}},s.prototype.collapse=function(t){this.graph._version++,(!1!==this.constructor.collapsable||t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},s.prototype.pin=function(t){this.graph._version++,this.flags.pinned=void 0===t?!this.flags.pinned:t},s.prototype.localToScreen=function(t,e,n){return[(t+this.pos[0])*n.scale+n.offset[0],(e+this.pos[1])*n.scale+n.offset[1]]},t.LGraphGroup=e.LGraphGroup=o,o.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=a.node_colors.pale_blue?a.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},o.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font=t.font},o.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font:this.font}},o.prototype.move=function(t,e,n){if(this._pos[0]+=t,this._pos[1]+=e,!n)for(var i=0;i<this._nodes.length;++i){var s=this._nodes[i];s.pos[0]+=t,s.pos[1]+=e}},o.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),n=0;n<t.length;++n){var i=t[n];i.getBounding(e),E(this._bounding,e)&&this._nodes.push(i)}},o.prototype.isPointInside=s.prototype.isPointInside,o.prototype.setDirtyCanvas=s.prototype.setDirtyCanvas,e.DragAndScale=r,r.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),t.addEventListener("mousedown",this._binded_mouse_callback),t.addEventListener("mousemove",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},r.prototype.computeVisibleArea=function(){if(this.element){var t=this.element.width,e=this.element.height,n=-this.offset[0],i=-this.offset[1],s=n+t/this.scale,o=i+e/this.scale;this.visible_area[0]=n,this.visible_area[1]=i,this.visible_area[2]=s-n,this.visible_area[3]=o-i}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0},r.prototype.onMouse=function(t){if(this.enabled){var e=this.element,n=e.getBoundingClientRect(),i=t.clientX-n.left,s=t.clientY-n.top;t.canvasx=i,t.canvasy=s,t.dragging=this.dragging;var o=!1;if(this.onmouse&&(o=this.onmouse(t)),"mousedown"==t.type)this.dragging=!0,e.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==t.type){if(!o){var r=i-this.last_mouse[0],a=s-this.last_mouse[1];this.dragging&&this.mouseDrag(r,a)}}else"mouseup"==t.type?(this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),e.addEventListener("mousemove",this._binded_mouse_callback)):"mousewheel"!=t.type&&"wheel"!=t.type&&"DOMMouseScroll"!=t.type||(t.eventType="mousewheel","wheel"==t.type?t.wheel=-t.deltaY:t.wheel=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+.05*t.delta));return this.last_mouse[0]=i,this.last_mouse[1]=s,t.preventDefault(),t.stopPropagation(),!1}},r.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},r.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},r.prototype.convertCanvasToOffset=function(t,e){return e=e||[0,0],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},r.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},r.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var n=this.element.getBoundingClientRect();if(n){e=e||[.5*n.width,.5*n.height];var i=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var s=this.convertCanvasToOffset(e),o=[s[0]-i[0],s[1]-i[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},r.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},r.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0},t.LGraphCanvas=e.LGraphCanvas=a,a.link_type_colors={"-1":e.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},a.gradients={},a.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},a.prototype.setGraph=function(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this.setDirty(!0,!0)):this.graph.detachCanvas(this))},a.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.setDirty(!0,!0)},a.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t]))}},a.prototype.getCurrentGraph=function(){return this.graph},a.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==t.getContext){if("canvas"!=t.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName;throw"This browser doesn't support Canvas"}var n=this.ctx=t.getContext("2d");null==n&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),e||this.bindEvents()}},a.prototype._doNothing=function(t){return t.preventDefault(),!1},a.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},a.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var t=this.canvas,e=this.getCanvasWindow(),n=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),t.addEventListener("mousedown",this._mousedown_callback,!0),t.addEventListener("mousemove",this._mousemove_callback),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),t.addEventListener("touchstart",this.touchHandler,!0),t.addEventListener("touchmove",this.touchHandler,!0),t.addEventListener("touchend",this.touchHandler,!0),t.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback,!0),n.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}},a.prototype.unbindEvents=function(){if(this._events_binded){var t=this.getCanvasWindow(),e=t.document;this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")},a.getFileExtension=function(t){var e=t.indexOf("?");-1!=e&&(t=t.substr(0,e));var n=t.lastIndexOf(".");return-1==n?"":t.substr(n+1).toLowerCase()},a.prototype.enableWebGL=function(){if(void 0===typeof GL)throw"litegl.js must be included to use a WebGL canvas";if(void 0===typeof enableWebGLCanvas)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},a.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},a.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},a.prototype.startRendering=function(){function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}this.is_rendering||(this.is_rendering=!0,t.call(this))},a.prototype.stopRendering=function(){this.is_rendering=!1},a.prototype.processMouseDown=function(t){if(this.graph){this.adjustMouseEvent(t);var n=this.getCanvasWindow();n.document;a.active_canvas=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback),n.document.addEventListener("mousemove",this._mousemove_callback,!0),n.document.addEventListener("mouseup",this._mouseup_callback,!0);var i=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),s=!1,o=e.getTime(),r=o-this.last_mouseclick<300;if(this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,this.canvas.focus(),e.closeAllContextMenus(n),!this.onMouse||1!=this.onMouse(t)){if(1==t.which){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,s=!0);var l=!1;if(i&&this.allow_interaction&&!s&&!this.read_only){if(this.live_mode||i.flags.pinned||this.bringToFront(i),!this.connecting_node&&!i.flags.collapsed&&!this.live_mode)if(!s&&!1!==i.resizable&&m(t.canvasX,t.canvasY,i.pos[0]+i.size[0]-5,i.pos[1]+i.size[1]-5,10,10))this.resizing_node=i,this.canvas.style.cursor="se-resize",s=!0;else{if(i.outputs)for(var u=0,h=i.outputs.length;u<h;++u){var c=i.outputs[u],p=i.getConnectionPos(!1,u);if(m(t.canvasX,t.canvasY,p[0]-15,p[1]-10,30,20)){this.connecting_node=i,this.connecting_output=c,this.connecting_pos=i.getConnectionPos(!1,u),this.connecting_slot=u,t.shiftKey&&i.disconnectOutput(u),r?i.onOutputDblClick&&i.onOutputDblClick(u,t):i.onOutputClick&&i.onOutputClick(u,t),s=!0;break}}if(i.inputs)for(u=0,h=i.inputs.length;u<h;++u){var d=i.inputs[u];p=i.getConnectionPos(!0,u);if(m(t.canvasX,t.canvasY,p[0]-15,p[1]-10,30,20)&&(r?i.onInputDblClick&&i.onInputDblClick(u,t):i.onInputClick&&i.onInputClick(u,t),null!==d.link)){var _=this.graph.links[d.link];i.disconnectInput(u),(this.allow_reconnect_links||t.shiftKey)&&(this.connecting_node=this.graph._nodes_by_id[_.origin_id],this.connecting_slot=_.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot)),this.dirty_bgcanvas=!0,s=!0}}}if(!s){var g=!1,v=this.processNodeWidgets(i,this.canvas_mouse,t);v&&(g=!0,this.node_widget=[i,v]),r&&this.selected_nodes[i.id]&&(i.onDblClick&&i.onDblClick(t,[t.canvasX-i.pos[0],t.canvasY-i.pos[1]],this),this.processNodeDblClicked(i),g=!0),i.onMouseDown&&i.onMouseDown(t,[t.canvasX-i.pos[0],t.canvasY-i.pos[1]],this)?g=!0:this.live_mode&&(l=!0,g=!0),g||(this.allow_dragnodes&&(this.node_dragged=i),this.selected_nodes[i.id]||this.processNodeSelected(i,t)),this.dirty_canvas=!0}}else{if(!this.read_only)for(u=0;u<this.visible_links.length;++u){var y=this.visible_links[u],b=y._pos;if(!(!b||t.canvasX<b[0]-4||t.canvasX>b[0]+4||t.canvasY<b[1]-4||t.canvasY>b[1]+4)){this.showLinkMenu(y,t);break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){t.ctrlKey&&(this.dragging_rectangle=null);var E=f([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);E*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}r&&!this.read_only&&this.showSearchBox(t),l=!0}!s&&l&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2==t.which||3==t.which&&(this.read_only||this.processContextMenu(i,t));return this.last_mouse[0]=t.localX,this.last_mouse[1]=t.localY,this.last_mouseclick=e.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!n.document.activeElement||"input"!=n.document.activeElement.nodeName.toLowerCase()&&"textarea"!=n.document.activeElement.nodeName.toLowerCase())&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}},a.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.graph){a.active_canvas=this,this.adjustMouseEvent(t);var n=[t.localX,t.localY],i=[n[0]-this.last_mouse[0],n[1]-this.last_mouse[1]];if(this.last_mouse=n,this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.canvas_mouse,t,this.node_widget[1]),this.dirty_canvas=!0),this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var s=i[0]/this.ds.scale,o=i[1]/this.ds.scale;this.selected_group.move(s,o,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=i[0]/this.ds.scale,this.ds.offset[1]+=i[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var r=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),l=0,u=this.graph._nodes.length;l<u;++l)this.graph._nodes[l].mouseOver&&r!=this.graph._nodes[l]&&(this.graph._nodes[l].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t,[t.canvasX-r.pos[0],t.canvasY-r.pos[1]],this),this.connecting_node){var h=this._highlight_input||[0,0];if(this.isOverNodeBox(r,t.canvasX,t.canvasY));else{var c=this.isOverNodeInput(r,t.canvasX,t.canvasY,h);if(-1!=c&&r.inputs[c]){var p=r.inputs[c].type;e.isValidConnection(this.connecting_output.type,p)&&(this._highlight_input=h)}else this._highlight_input=null}}this.canvas&&(m(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else this.canvas&&(this.canvas.style.cursor="");if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t),this.node_dragged&&!this.live_mode){for(var l in this.selected_nodes){var d=this.selected_nodes[l];d.pos[0]+=i[0]/this.ds.scale,d.pos[1]+=i[1]/this.ds.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]=t.canvasX-this.resizing_node.pos[0],this.resizing_node.size[1]=t.canvasY-this.resizing_node.pos[1];var _=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0),g=_*e.NODE_SLOT_HEIGHT+(this.resizing_node.widgets?this.resizing_node.widgets.length:0)*(e.NODE_WIDGET_HEIGHT+4)+4;this.resizing_node.size[1]<g&&(this.resizing_node.size[1]=g),this.resizing_node.size[0]<e.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=e.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},a.prototype.processMouseUp=function(t){if(this.graph){var n=this.getCanvasWindow(),i=n.document;a.active_canvas=this,i.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),i.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(t);var s=e.getTime();if(t.click_time=s-this.last_mouseclick,this.last_mouse_dragging=!1,1==t.which){if(this.node_widget=null,this.selected_group){var o=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),r=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(o,r,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}if(this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,u=new Float32Array(4);this.deselectAllNodes();var h=Math.abs(this.dragging_rectangle[2]),c=Math.abs(this.dragging_rectangle[3]),p=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-h:this.dragging_rectangle[0],d=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-c:this.dragging_rectangle[1];this.dragging_rectangle[0]=p,this.dragging_rectangle[1]=d,this.dragging_rectangle[2]=h,this.dragging_rectangle[3]=c;for(var _=[],g=0;g<l.length;++g){var f=l[g];f.getBounding(u),E(this.dragging_rectangle,u)&&_.push(f)}_.length&&this.selectNodes(_)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;f=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(f)if(this.connecting_output.type==e.EVENT&&this.isOverNodeBox(f,t.canvasX,t.canvasY))this.connecting_node.connect(this.connecting_slot,f,e.EVENT);else{var v=this.isOverNodeInput(f,t.canvasX,t.canvasY);if(-1!=v)this.connecting_node.connect(this.connecting_slot,f,v);else{var y=f.getInputInfo(0);this.connecting_output.type==e.EVENT?this.connecting_node.connect(this.connecting_slot,f,e.EVENT):y&&!y.link&&e.isValidConnection(y.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,f,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null;else if(this.node_dragged){f=this.node_dragged;f&&t.click_time<300&&m(t.canvasX,t.canvasY,f.pos[0],f.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT)&&f.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),this.graph.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null}else{f=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!f&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else 2==t.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==t.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},a.prototype.processMouseWheel=function(t){if(this.graph&&this.allow_dragcanvas){var e=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.adjustMouseEvent(t);var n=this.ds.scale;return e>0?n*=1.1:e<0&&(n*=1/1.1),this.ds.changeScale(n,[t.localX,t.localY]),this.graph.change(),t.preventDefault(),!1}},a.prototype.isOverNodeBox=function(t,n,i){var s=e.NODE_TITLE_HEIGHT;return!!m(n,i,t.pos[0]+2,t.pos[1]+2-s,s-4,s-4)},a.prototype.isOverNodeInput=function(t,e,n,i){if(t.inputs)for(var s=0,o=t.inputs.length;s<o;++s){t.inputs[s];var r=t.getConnectionPos(!0,s),a=!1;if(a=t.horizontal?m(e,n,r[0]-5,r[1]-10,10,20):m(e,n,r[0]-10,r[1]-5,40,10),a)return i&&(i[0]=r[0],i[1]=r[1]),s}return-1},a.prototype.processKey=function(t){if(this.graph){var e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(32==t.keyCode&&(this.dragging_canvas=!0,e=!0),65==t.keyCode&&t.ctrlKey&&(this.selectNodes(),e=!0),"KeyC"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.selected_nodes&&(this.copyToClipboard(),e=!0),"KeyV"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.pasteFromClipboard(),46!=t.keyCode&&8!=t.keyCode||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(t)}else if("keyup"==t.type&&(32==t.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var n in this.selected_nodes)this.selected_nodes[n].onKeyUp&&this.selected_nodes[n].onKeyUp(t);return this.graph.change(),e?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}},a.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,n=[];for(var i in this.selected_nodes){var s=this.selected_nodes[i];s._relative_id=e,n.push(s),e+=1}for(i=0;i<n.length;++i){s=n[i];if(t.nodes.push(s.clone().serialize()),s.inputs&&s.inputs.length)for(var o=0;o<s.inputs.length;++o){var r=s.inputs[o];if(r&&null!=r.link){var a=this.graph.links[r.link];if(a){var l=this.graph.getNodeById(a.origin_id);l&&this.selected_nodes[l.id]&&t.links.push([l._relative_id,o,s._relative_id,a.target_slot])}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},a.prototype.pasteFromClipboard=function(){var t=localStorage.getItem("litegrapheditor_clipboard");if(t){for(var n=JSON.parse(t),i=[],s=0;s<n.nodes.length;++s){var o=n.nodes[s],r=e.createNode(o.type);r&&(r.configure(o),r.pos[0]+=5,r.pos[1]+=5,this.graph.add(r),i.push(r))}for(s=0;s<n.links.length;++s){var a=n.links[s],l=i[a[0]],u=i[a[2]];l.connect(a[1],u,a[3])}this.selectNodes(i)}},a.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=[t.canvasX,t.canvasY],n=this.graph.getNodeOnPos(e[0],e[1]);if(!n){var i=null;return this.onDropItem&&(i=this.onDropItem(event)),void(i||this.checkDropItem(t))}if(n.onDropFile||n.onDropData){var s=t.dataTransfer.files;if(s&&s.length)for(var o=0;o<s.length;o++){var r=t.dataTransfer.files[0],l=r.name;a.getFileExtension(l);if(n.onDropFile&&n.onDropFile(r),n.onDropData){var u=new FileReader;u.onload=function(t){var e=t.target.result;n.onDropData(e,l,r)};var h=r.type.split("/")[0];"text"==h||""==h?u.readAsText(r):"image"==h?u.readAsDataURL(r):u.readAsArrayBuffer(r)}}}return!(!n.onDropItem||!n.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)},a.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var n=t.dataTransfer.files[0],i=a.getFileExtension(n.name).toLowerCase(),s=e.node_types_by_file_extension[i];if(s){var o=e.createNode(s.type);o.pos=[t.canvasX,t.canvasY],this.graph.add(o),o.onDropFile&&o.onDropFile(n)}}},a.prototype.processNodeDblClicked=function(t){this.onShowNodePanel&&this.onShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},a.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&e.shiftKey),this.onNodeSelected&&this.onNodeSelected(t)},a.prototype.processNodeDeselected=function(t){this.deselectNode(t),this.onNodeDeselected&&this.onNodeDeselected(t)},a.prototype.selectNode=function(t,e){null==t?this.deselectAllNodes():this.selectNodes([t],e)},a.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes;for(var n=0;n<t.length;++n){var i=t[n];if(!i.is_selected){if(!i.is_selected&&i.onSelected&&i.onSelected(),i.is_selected=!0,this.selected_nodes[i.id]=i,i.inputs)for(var s=0;s<i.inputs.length;++s)this.highlighted_links[i.inputs[s].link]=!0;if(i.outputs)for(s=0;s<i.outputs.length;++s){var o=i.outputs[s];if(o.links)for(var r=0;r<o.links.length;++r)this.highlighted_links[o.links[r]]=!0}}}this.setDirty(!0)},a.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(e=0;e<t.outputs.length;++e){var n=t.outputs[e];if(n.links)for(var i=0;i<n.links.length;++i)delete this.highlighted_links[n.links[i]]}}},a.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,n=t.length;e<n;++e){var i=t[e];i.is_selected&&(i.onDeselected&&i.onDeselected(),i.is_selected=!1)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)}},a.prototype.deleteSelectedNodes=function(){for(var t in this.selected_nodes){var e=this.selected_nodes[t];this.graph.remove(e)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)},a.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/this.ds.scale,this.ds.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/this.ds.scale,this.setDirty(!0,!0)},a.prototype.adjustMouseEvent=function(t){if(this.canvas){var e=this.canvas.getBoundingClientRect();t.localX=t.clientX-e.left,t.localY=t.clientY-e.top}else t.localX=t.clientX,t.localY=t.clientY;t.deltaX=t.localX-this.last_mouse_position[0],t.deltaY=t.localY-this.last_mouse_position[1],this.last_mouse_position[0]=t.localX,this.last_mouse_position[1]=t.localY,t.canvasX=t.localX/this.ds.scale-this.ds.offset[0],t.canvasY=t.localY/this.ds.scale-this.ds.offset[1]},a.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},a.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},a.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},a.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},a.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},a.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var l=new Float32Array(4);a.prototype.computeVisibleNodes=function(t,e){var n=e||[];n.length=0,t=t||this.graph._nodes;for(var i=0,s=t.length;i<s;++i){var o=t[i];(!this.live_mode||o.onDrawBackground||o.onDrawForeground)&&(E(this.visible_area,o.getBounding(l))&&n.push(o))}return n},a.prototype.draw=function(t,n){if(this.canvas){var i=e.getTime();this.render_time=.001*(i-this.last_draw_time),this.last_draw_time=i,this.graph&&this.ds.computeVisibleArea(),(this.dirty_bgcanvas||n||this.always_render_background||this.graph&&this.graph._last_trigger_time&&i-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},a.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){t.start2D&&t.start2D();var n=this.canvas;if(t.restore(),t.setTransform(1,0,0,1,0,0),this.dirty_area&&(t.save(),t.beginPath(),t.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),t.clip()),this.clear_background&&t.clearRect(0,0,n.width,n.height),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(n,t),this.show_info&&this.renderInfo(t),this.graph){t.save(),this.ds.toCanvasContext(t);for(var i=this.computeVisibleNodes(null,this.visible_nodes),s=0;s<i.length;++s){var o=i[s];t.save(),t.translate(o.pos[0],o.pos[1]),this.drawNode(o,t),1,t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),null!=this.connecting_pos){t.lineWidth=this.connections_width;var r=null;switch(this.connecting_output.type){case e.EVENT:r=e.EVENT_LINK_COLOR;break;default:r=e.CONNECTING_LINK_COLOR}this.renderLink(t,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,r,this.connecting_output.dir||(this.connecting_node.horizontal?e.DOWN:e.RIGHT),e.CENTER),t.beginPath(),this.connecting_output.type===e.EVENT||this.connecting_output.shape===e.BOX_SHAPE?t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),t.fill(),t.fillStyle="#ffcc00",this._highlight_input&&(t.beginPath(),t.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this.onDrawOverlay&&this.onDrawOverlay(t),this.dirty_area&&t.restore(),t.finish2D&&t.finish2D()}},a.prototype.renderInfo=function(t,e,n){e=e||0,n=n||0,t.save(),t.translate(e,n),t.font="10px Arial",t.fillStyle="#888",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},a.prototype.drawBackCanvas=function(){var t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;if(e.start&&e.start(),this.clear_background&&e.clearRect(0,0,t.width,t.height),this._graph_stack&&this._graph_stack.length){e.save();this._graph_stack[this._graph_stack.length-1];var n=this.graph._subgraph_node;e.strokeStyle=n.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=n.bgcolor||"#AAA";for(var i="",s=1;s<this._graph_stack.length;++s)i+=this._graph_stack[s]._subgraph_node.getTitle()+" >> ";e.fillText(i+n.getTitle(),.5*t.width,40),e.restore()}var o=!1;if(this.onRenderBackground&&(o=this.onRenderBackground(t,e)),e.restore(),e.setTransform(1,0,0,1,0,0),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.background_image&&this.ds.scale>.5&&!o){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var r=this;this._bg_img.onload=function(){r.draw(!0,!0)}}var a=null;null==this._pattern&&this._bg_img.width>0?(a=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=a):a=this._pattern,a&&(e.fillStyle=a,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var u=new Float32Array(2);a.prototype.drawNode=function(t,n){this.current_node=t;var i=t.color||t.constructor.color||e.NODE_DEFAULT_COLOR,s=t.bgcolor||t.constructor.bgcolor||e.NODE_DEFAULT_BGCOLOR;if(t.mouseOver&&!0,this.live_mode)t.flags.collapsed||(n.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(n,this,this.canvas));else{var o=this.editor_alpha;if(n.globalAlpha=o,this.render_shadows?(n.shadowColor=e.DEFAULT_SHADOW_COLOR,n.shadowOffsetX=2*this.ds.scale,n.shadowOffsetY=2*this.ds.scale,n.shadowBlur=3*this.ds.scale):n.shadowColor="transparent",!t.flags.collapsed||!t.onDrawCollapsed||1!=t.onDrawCollapsed(n,this)){var r=t._shape||e.BOX_SHAPE,a=u;u.set(t.size);var l=t.horizontal;if(t.flags.collapsed){n.font=this.inner_text_font;var h=t.getTitle?t.getTitle():t.title;null!=h&&(t._collapsed_width=Math.min(t.size[0],n.measureText(h).width+2*e.NODE_TITLE_HEIGHT),a[0]=t._collapsed_width,a[1]=0)}t.clip_area&&(n.save(),n.beginPath(),r==e.BOX_SHAPE?n.rect(0,0,a[0],a[1]):r==e.ROUND_SHAPE?n.roundRect(0,0,a[0],a[1],10):r==e.CIRCLE_SHAPE&&n.arc(.5*a[0],.5*a[1],.5*a[0],0,2*Math.PI),n.clip()),t.has_errors&&(s="red"),this.drawNodeShape(t,n,a,i,s,t.is_selected,t.mouseOver),n.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(n,this,this.canvas),n.textAlign=l?"center":"left",n.font=this.inner_text_font;var c=this.ds.scale>.6,p=this.connecting_output;n.lineWidth=1;var d=0,_=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var g=null,f=null;if(t.inputs)for(y=0;y<t.inputs.length;y++){b=t.inputs[y];if(null!=b.link){g=b;break}}if(t.outputs)for(y=0;y<t.outputs.length;y++){b=t.outputs[y];b.links&&b.links.length&&(f=b)}if(g){var v=0,m=-.5*e.NODE_TITLE_HEIGHT;l&&(v=.5*t._collapsed_width,m=-e.NODE_TITLE_HEIGHT),n.fillStyle="#686",n.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?n.rect(v-7+.5,m-4,14,8):b.shape===e.ARROW_SHAPE?(n.moveTo(v+8,m),n.lineTo(v+-4,m-4),n.lineTo(v+-4,m+4),n.closePath()):n.arc(v,m,4,0,2*Math.PI),n.fill()}if(f){v=t._collapsed_width,m=-.5*e.NODE_TITLE_HEIGHT;l&&(v=.5*t._collapsed_width,m=0),n.fillStyle="#686",n.strokeStyle="black",n.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?n.rect(v-7+.5,m-4,14,8):b.shape===e.ARROW_SHAPE?(n.moveTo(v+6,m),n.lineTo(v-6,m-4),n.lineTo(v-6,m+4),n.closePath()):n.arc(v,m,4,0,2*Math.PI),n.fill()}}}else{if(t.inputs)for(var y=0;y<t.inputs.length;y++){var b=t.inputs[y];n.globalAlpha=o,this.connecting_node&&e.isValidConnection(b.type&&p.type)&&(n.globalAlpha=.4*o),n.fillStyle=null!=b.link?b.color_on||this.default_connection_color.input_on:b.color_off||this.default_connection_color.input_off;var E=t.getConnectionPos(!0,y,_);if(E[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*e.NODE_SLOT_HEIGHT&&(d=E[1]+.5*e.NODE_SLOT_HEIGHT),n.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?l?n.rect(E[0]-5+.5,E[1]-8+.5,10,14):n.rect(E[0]-6+.5,E[1]-5+.5,14,10):b.shape===e.ARROW_SHAPE?(n.moveTo(E[0]+8,E[1]+.5),n.lineTo(E[0]-4,E[1]+6+.5),n.lineTo(E[0]-4,E[1]-6+.5),n.closePath()):n.arc(E[0],E[1],4,0,2*Math.PI),n.fill(),c){var T=null!=b.label?b.label:b.name;T&&(n.fillStyle=e.NODE_TEXT_COLOR,l||b.dir==e.UP?n.fillText(T,E[0],E[1]-10):n.fillText(T,E[0]+10,E[1]+5))}}if(this.connecting_node&&(n.globalAlpha=.4*o),n.textAlign=l?"center":"right",n.strokeStyle="black",t.outputs)for(var y=0;y<t.outputs.length;y++){var b=t.outputs[y];E=t.getConnectionPos(!1,y,_);if(E[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*e.NODE_SLOT_HEIGHT&&(d=E[1]+.5*e.NODE_SLOT_HEIGHT),n.fillStyle=b.links&&b.links.length?b.color_on||this.default_connection_color.output_on:b.color_off||this.default_connection_color.output_off,n.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?l?n.rect(E[0]-5+.5,E[1]-8+.5,10,14):n.rect(E[0]-6+.5,E[1]-5+.5,14,10):b.shape===e.ARROW_SHAPE?(n.moveTo(E[0]+8,E[1]+.5),n.lineTo(E[0]-4,E[1]+6+.5),n.lineTo(E[0]-4,E[1]-6+.5),n.closePath()):n.arc(E[0],E[1],4,0,2*Math.PI),n.fill(),n.stroke(),c){T=null!=b.label?b.label:b.name;T&&(n.fillStyle=e.NODE_TEXT_COLOR,l||b.dir==e.DOWN?n.fillText(T,E[0],E[1]-8):n.fillText(T,E[0]-10,E[1]+5))}}n.textAlign="left",n.globalAlpha=1,t.widgets&&((l||t.widgets_up)&&(d=2),this.drawNodeWidgets(t,d,n,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null))}t.clip_area&&n.restore(),n.globalAlpha=1}}};var h=new Float32Array(4);a.prototype.drawNodeShape=function(t,n,i,s,o,r,l){n.strokeStyle=s,n.fillStyle=o;var u=e.NODE_TITLE_HEIGHT,c=this.ds.scale<.5,p=t._shape||t.constructor.shape||e.ROUND_SHAPE,d=t.constructor.title_mode,_=!0;d==e.TRANSPARENT_TITLE?_=!1:d==e.AUTOHIDE_TITLE&&l&&(_=!0);var g=h;g[0]=0,g[1]=_?-u:0,g[2]=i[0]+1,g[3]=_?i[1]+u:i[1];var f=n.globalAlpha;if(n.beginPath(),p==e.BOX_SHAPE||c?n.fillRect(g[0],g[1],g[2],g[3]):p==e.ROUND_SHAPE||p==e.CARD_SHAPE?n.roundRect(g[0],g[1],g[2],g[3],this.round_radius,p==e.CARD_SHAPE?0:this.round_radius):p==e.CIRCLE_SHAPE&&n.arc(.5*i[0],.5*i[1],.5*i[0],0,2*Math.PI),n.fill(),n.shadowColor="transparent",n.fillStyle="rgba(0,0,0,0.2)",n.fillRect(0,-1,g[2],2),n.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(n,this,this.canvas),_||d==e.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(n,u,i,this.ds.scale,s);else if(d!=e.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var v=t.constructor.title_color||s;if(t.flags.collapsed&&(n.shadowColor=e.DEFAULT_SHADOW_COLOR),this.use_gradients){var m=a.gradients[v];m||(m=a.gradients[v]=n.createLinearGradient(0,0,400,0),m.addColorStop(0,v),m.addColorStop(1,"#000")),n.fillStyle=m}else n.fillStyle=v;n.beginPath(),p==e.BOX_SHAPE||c?n.rect(0,-u,i[0]+1,u):p!=e.ROUND_SHAPE&&p!=e.CARD_SHAPE||n.roundRect(0,-u,i[0]+1,u,this.round_radius,t.flags.collapsed?this.round_radius:0),n.fill(),n.shadowColor="transparent"}var y=10;if(t.onDrawTitleBox?t.onDrawTitleBox(n,u,i,this.ds.scale):p==e.ROUND_SHAPE||p==e.CIRCLE_SHAPE||p==e.CARD_SHAPE?(c&&(n.fillStyle="black",n.beginPath(),n.arc(.5*u,-.5*u,.5*y+1,0,2*Math.PI),n.fill()),n.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,n.beginPath(),n.arc(.5*u,-.5*u,.5*y,0,2*Math.PI),n.fill()):(c&&(n.fillStyle="black",n.fillRect(.5*(u-y)-1,-.5*(u+y)-1,y+2,y+2)),n.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,n.fillRect(.5*(u-y),-.5*(u+y),y,y)),n.globalAlpha=f,t.onDrawTitleText&&t.onDrawTitleText(n,u,i,this.ds.scale,this.title_text_font,r),!c){n.font=this.title_text_font;var b=t.getTitle();if(b)if(n.fillStyle=r?"white":t.constructor.title_text_color||this.node_title_color,t.flags.collapsed){n.textAlign="center";var E=n.measureText(b);n.fillText(b,u+.5*E.width,e.NODE_TITLE_TEXT_Y-u),n.textAlign="left"}else n.textAlign="left",n.fillText(b,u,e.NODE_TITLE_TEXT_Y-u)}t.onDrawTitle&&t.onDrawTitle(n)}r&&(t.onBounding&&t.onBounding(g),d==e.TRANSPARENT_TITLE&&(g[1]-=u,g[3]+=u),n.lineWidth=1,n.globalAlpha=.8,n.beginPath(),p==e.BOX_SHAPE?n.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):p==e.ROUND_SHAPE||p==e.CARD_SHAPE&&t.flags.collapsed?n.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius):p==e.CARD_SHAPE?n.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius,2):p==e.CIRCLE_SHAPE&&n.arc(.5*i[0],.5*i[1],.5*i[0]+6,0,2*Math.PI),n.strokeStyle="#FFF",n.stroke(),n.strokeStyle=s,n.globalAlpha=1)};var c=new Float32Array(4),p=new Float32Array(4),d=new Float32Array(2),_=new Float32Array(2);function g(t,e){for(var n in t)if(t[n]!=e[n])return!1;return!0}function f(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function v(t){return"rgba("+Math.round(255*t[0]).toFixed()+","+Math.round(255*t[1]).toFixed()+","+Math.round(255*t[2]).toFixed()+","+(4==t.length?t[3].toFixed(2):"1.0")+")"}function m(t,e,n,i,s,o){return n<t&&n+s>t&&i<e&&i+o>e}function y(t,e,n){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),n<t[1]?t[1]=n:n>t[3]&&(t[3]=n)}function b(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}function E(t,e){var n=t[0]+t[2],i=t[1]+t[3],s=e[0]+e[2],o=e[1]+e[3];return!(t[0]>s||t[1]>o||n<e[0]||i<e[1])}function T(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();for(var e,n,i="0123456789ABCDEF",s=new Array(3),o=0,r=0;r<6;r+=2)e=i.indexOf(t.charAt(r)),n=i.indexOf(t.charAt(r+1)),s[o]=16*e+n,o++;return s}function w(t){for(var e,n,i="0123456789ABCDEF",s="#",o=0;o<3;o++)e=t[o]/16,n=t[o]%16,s+=i.charAt(e)+i.charAt(n);return s}function k(t,e){e=e||{},this.options=e;var n=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),e.event&&e.event.constructor!==MouseEvent&&e.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),e.event=null);var i=document.createElement("div");function s(t){var n=parseInt(i.style.top);return i.style.top=(n+t.deltaY*e.scroll_speed).toFixed()+"px",t.preventDefault(),!0}if(i.className="litegraph litecontextmenu litemenubar-panel",e.className&&(i.className+=" "+e.className),i.style.minWidth=100,i.style.minHeight=100,i.style.pointerEvents="none",setTimeout(function(){i.style.pointerEvents="auto"},100),i.addEventListener("mouseup",function(t){return t.preventDefault(),!0},!0),i.addEventListener("contextmenu",function(t){return 2==t.button&&(t.preventDefault(),!1)},!0),i.addEventListener("mousedown",function(t){if(2==t.button)return n.close(),t.preventDefault(),!0},!0),e.scroll_speed||(e.scroll_speed=.1),i.addEventListener("wheel",s,!0),i.addEventListener("mousewheel",s,!0),this.root=i,e.title){var o=document.createElement("div");o.className="litemenu-title",o.innerHTML=e.title,i.appendChild(o)}for(var r in t){var a=t.constructor==Array?t[r]:r;null!=a&&a.constructor!==String&&(a=void 0===a.content?String(a):a.content);var l=t[r];this.addItem(a,l,e),0}i.addEventListener("mouseleave",function(t){n.lock||(i.closing_timer&&clearTimeout(i.closing_timer),i.closing_timer=setTimeout(n.close.bind(n,t),500))}),i.addEventListener("mouseenter",function(t){i.closing_timer&&clearTimeout(i.closing_timer)});var u=document;e.event&&(u=e.event.target.ownerDocument),u||(u=document),u.body.appendChild(i);var h=e.left||0,c=e.top||0;if(e.event){if(h=e.event.clientX-10,c=e.event.clientY-10,e.title&&(c-=20),e.parentMenu){var p=e.parentMenu.root.getBoundingClientRect();h=p.left+p.width}var d=document.body.getBoundingClientRect(),_=i.getBoundingClientRect();h>d.width-_.width-10&&(h=d.width-_.width-10),c>d.height-_.height-10&&(c=d.height-_.height-10)}i.style.left=h+"px",i.style.top=c+"px",e.scale&&(i.style.transform="scale("+e.scale+")")}a.prototype.drawConnections=function(t){var n=e.getTime(),i=this.visible_area;c[0]=i[0]-20,c[1]=i[1]-20,c[2]=i[2]+40,c[3]=i[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var s=this.graph._nodes,o=0,r=s.length;o<r;++o){var a=s[o];if(a.inputs&&a.inputs.length)for(var l=0;l<a.inputs.length;++l){var u=a.inputs[l];if(u&&null!=u.link){var h=u.link,g=this.graph.links[h];if(g){var f=this.graph.getNodeById(g.origin_id);if(null!=f){var v=g.origin_slot,m=null;m=-1==v?[f.pos[0]+10,f.pos[1]+10]:f.getConnectionPos(!1,v,d);var y=a.getConnectionPos(!0,l,_);if(p[0]=m[0],p[1]=m[1],p[2]=y[0]-m[0],p[3]=y[1]-m[1],p[2]<0&&(p[0]+=p[2],p[2]=Math.abs(p[2])),p[3]<0&&(p[1]+=p[3],p[3]=Math.abs(p[3])),E(p,c)){var b=f.outputs[v],T=a.inputs[l];if(b&&T){var w=b.dir||(f.horizontal?e.DOWN:e.RIGHT),k=T.dir||(a.horizontal?e.UP:e.LEFT);if(this.renderLink(t,m,y,g,!1,0,null,w,k),g&&g._last_time&&n-g._last_time<1e3){var O=2-.002*(n-g._last_time),D=t.globalAlpha;t.globalAlpha=D*O,this.renderLink(t,m,y,g,!0,O,"white",w,k),t.globalAlpha=D}}}}}}}}t.globalAlpha=1},a.prototype.renderLink=function(t,n,i,s,o,r,l,u,h,c){s&&this.visible_links.push(s),!l&&s&&(l=s.color||a.link_type_colors[s.type]),l||(l=this.default_link_color),null!=s&&this.highlighted_links[s.id]&&(l="#FFF"),u=u||e.RIGHT,h=h||e.LEFT;var p=f(n,i);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",c=c||1,c>1&&(t.lineWidth=.5),t.beginPath();for(var d=0;d<c;d+=1){var _=5*(d-.5*(c-1));if(this.links_render_mode==e.SPLINE_LINK){t.moveTo(n[0],n[1]+_);var g=0,v=0,m=0,y=0;switch(u){case e.LEFT:g=-.25*p;break;case e.RIGHT:g=.25*p;break;case e.UP:v=-.25*p;break;case e.DOWN:v=.25*p;break}switch(h){case e.LEFT:m=-.25*p;break;case e.RIGHT:m=.25*p;break;case e.UP:y=-.25*p;break;case e.DOWN:y=.25*p;break}t.bezierCurveTo(n[0]+g,n[1]+v+_,i[0]+m,i[1]+y+_,i[0],i[1]+_)}else if(this.links_render_mode==e.LINEAR_LINK){t.moveTo(n[0],n[1]+_);g=0,v=0,m=0,y=0;switch(u){case e.LEFT:g=-1;break;case e.RIGHT:g=1;break;case e.UP:v=-1;break;case e.DOWN:v=1;break}switch(h){case e.LEFT:m=-1;break;case e.RIGHT:m=1;break;case e.UP:y=-1;break;case e.DOWN:y=1;break}var b=15;t.lineTo(n[0]+g*b,n[1]+v*b+_),t.lineTo(i[0]+m*b,i[1]+y*b+_),t.lineTo(i[0],i[1]+_)}else{if(this.links_render_mode!=e.STRAIGHT_LINK)return;t.moveTo(n[0],n[1]);var E=n[0],T=n[1],w=i[0],k=i[1];u==e.RIGHT?E+=10:T+=10,h==e.LEFT?w-=10:k-=10,t.lineTo(E,T),t.lineTo(.5*(E+w),T),t.lineTo(.5*(E+w),k),t.lineTo(w,k),t.lineTo(i[0],i[1])}}this.render_connections_border&&this.ds.scale>.6&&!o&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=l,t.stroke();var O=this.computeConnectionPoint(n,i,.5,u,h);if(s&&s._pos&&(s._pos[0]=O[0],s._pos[1]=O[1]),this.ds.scale>=.6&&this.highquality_render&&h!=e.CENTER){if(this.render_connection_arrows){var D=this.computeConnectionPoint(n,i,.25,u,h),N=this.computeConnectionPoint(n,i,.26,u,h),C=this.computeConnectionPoint(n,i,.75,u,h),I=this.computeConnectionPoint(n,i,.76,u,h),x=0,A=0;this.render_curved_connections?(x=-Math.atan2(N[0]-D[0],N[1]-D[1]),A=-Math.atan2(I[0]-C[0],I[1]-C[1])):A=x=i[1]>n[1]?0:Math.PI,t.save(),t.translate(D[0],D[1]),t.rotate(x),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(C[0],C[1]),t.rotate(A),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(O[0],O[1],5,0,2*Math.PI),t.fill()}if(r){t.fillStyle=l;for(d=0;d<5;++d){var S=(.001*e.getTime()+.2*d)%1;O=this.computeConnectionPoint(n,i,S,u,h);t.beginPath(),t.arc(O[0],O[1],5,0,2*Math.PI),t.fill()}}},a.prototype.computeConnectionPoint=function(t,n,i,s,o){s=s||e.RIGHT,o=o||e.LEFT;var r=f(t,n),a=t,l=[t[0],t[1]],u=[n[0],n[1]],h=n;switch(s){case e.LEFT:l[0]+=-.25*r;break;case e.RIGHT:l[0]+=.25*r;break;case e.UP:l[1]+=-.25*r;break;case e.DOWN:l[1]+=.25*r;break}switch(o){case e.LEFT:u[0]+=-.25*r;break;case e.RIGHT:u[0]+=.25*r;break;case e.UP:u[1]+=-.25*r;break;case e.DOWN:u[1]+=.25*r;break}var c=(1-i)*(1-i)*(1-i),p=(1-i)*(1-i)*3*i,d=3*(1-i)*(i*i),_=i*i*i,g=c*a[0]+p*l[0]+d*u[0]+_*h[0],v=c*a[1]+p*l[1]+d*u[1]+_*h[1];return[g,v]},a.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var n=this.visible_nodes,i=0;i<n.length;++i){var s=n[i];t.fillStyle="black",t.fillRect(s.pos[0]-e.NODE_TITLE_HEIGHT,s.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),0==s.order&&t.strokeRect(s.pos[0]-e.NODE_TITLE_HEIGHT+.5,s.pos[1]-e.NODE_TITLE_HEIGHT+.5,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(s.order,s.pos[0]+-.5*e.NODE_TITLE_HEIGHT,s.pos[1]-6)}t.globalAlpha=1},a.prototype.drawNodeWidgets=function(t,n,i,s){if(!t.widgets||!t.widgets.length)return 0;var o=t.size[0],r=t.widgets;n+=2;var a=e.NODE_WIDGET_HEIGHT,l=this.ds.scale>.5;i.save(),i.globalAlpha=this.editor_alpha;for(var u="#666",h="#222",c=15,p=0;p<r.length;++p){var d=r[p],_=n;switch(d.y&&(_=d.y),d.last_y=_,i.strokeStyle=u,i.fillStyle="#222",i.textAlign="left",d.type){case"button":d.clicked&&(i.fillStyle="#AAA",d.clicked=!1,this.dirty_canvas=!0),i.fillRect(c,_,o-2*c,a),i.strokeRect(c,_,o-2*c,a),l&&(i.textAlign="center",i.fillStyle="#AAA",i.fillText(d.name,.5*o,_+.7*a));break;case"toggle":i.textAlign="left",i.strokeStyle=u,i.fillStyle=h,i.beginPath(),i.roundRect(c,n,o-2*c,a,.5*a),i.fill(),i.stroke(),i.fillStyle=d.value?"#89A":"#333",i.beginPath(),i.arc(o-2*c,_+.5*a,.36*a,0,2*Math.PI),i.fill(),l&&(i.fillStyle="#999",null!=d.name&&i.fillText(d.name,2*c,_+.7*a),i.fillStyle=d.value?"#DDD":"#888",i.textAlign="right",i.fillText(d.value?d.options.on||"true":d.options.off||"false",o-40,_+.7*a));break;case"slider":i.fillStyle=h,i.fillRect(c,_,o-2*c,a);var g=d.options.max-d.options.min,f=(d.value-d.options.min)/g;if(i.fillStyle=s==d?"#89A":"#678",i.fillRect(c,_,f*(o-2*c),a),i.strokeRect(c,_,o-2*c,a),d.marker){var v=(d.marker-d.options.min)/g;i.fillStyle="#AA9",i.fillRect(c+v*(o-2*c),_,2,a)}l&&(i.textAlign="center",i.fillStyle="#DDD",i.fillText(d.name+"  "+Number(d.value).toFixed(3),.5*o,_+.7*a));break;case"number":case"combo":i.textAlign="left",i.strokeStyle=u,i.fillStyle=h,i.beginPath(),i.roundRect(c,n,o-2*c,a,.5*a),i.fill(),i.stroke(),l&&(i.fillStyle="#AAA",i.beginPath(),i.moveTo(c+16,n+5),i.lineTo(c+6,n+.5*a),i.lineTo(c+16,n+a-5),i.moveTo(o-c-16,n+5),i.lineTo(o-c-6,n+.5*a),i.lineTo(o-c-16,n+a-5),i.fill(),i.fillStyle="#999",i.fillText(d.name,2*c+5,_+.7*a),i.fillStyle="#DDD",i.textAlign="right","number"==d.type?i.fillText(Number(d.value).toFixed(void 0!==d.options.precision?d.options.precision:3),o-2*c-20,_+.7*a):i.fillText(d.value,o-2*c-20,_+.7*a));break;case"string":case"text":i.textAlign="left",i.strokeStyle=u,i.fillStyle=h,i.beginPath(),i.roundRect(c,n,o-2*c,a,.5*a),i.fill(),i.stroke(),l&&(i.fillStyle="#999",null!=d.name&&i.fillText(d.name,2*c,_+.7*a),i.fillStyle="#DDD",i.textAlign="right",i.fillText(d.value,o-2*c,_+.7*a));break;default:d.draw&&d.draw(i,t,d,_,a);break}n+=a+4}i.restore()},a.prototype.processNodeWidgets=function(t,n,i,s){if(!t.widgets||!t.widgets.length)return null;for(var o=n[0]-t.pos[0],r=n[1]-t.pos[1],a=t.size[0],l=this,u=this.getCanvasWindow(),h=0;h<t.widgets.length;++h){var c=t.widgets[h];if(c==s||o>6&&o<a-12&&r>c.last_y&&r<c.last_y+e.NODE_WIDGET_HEIGHT){switch(c.type){case"button":if("mousemove"===i.type)break;c.callback&&setTimeout(function(){c.callback(c,l,t,n)},20),c.clicked=!0,this.dirty_canvas=!0;break;case"slider":c.options.max,c.options.min;var p=Math.clamp((o-10)/(a-20),0,1);c.value=c.options.min+(c.options.max-c.options.min)*p,c.callback&&setTimeout(function(){v(c,c.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":if("mousemove"==i.type&&"number"==c.type)c.value+=.1*i.deltaX*(c.options.step||1),null!=c.options.min&&c.value<c.options.min&&(c.value=c.options.min),null!=c.options.max&&c.value>c.options.max&&(c.value=c.options.max);else if("mousedown"==i.type){var d=c.options.values;d&&d.constructor===Function&&(d=c.options.values(c,t));var _=o<40?-1:o>a-40?1:0;if("number"==c.type)c.value+=.1*_*(c.options.step||1),null!=c.options.min&&c.value<c.options.min&&(c.value=c.options.min),null!=c.options.max&&c.value>c.options.max&&(c.value=c.options.max);else if(_){var g=d.indexOf(c.value)+_;g>=d.length&&(g=0),g<0&&(g=d.length-1),c.value=d[g]}else{new e.ContextMenu(d,{scale:Math.max(1,this.ds.scale),event:i,className:"dark",callback:f.bind(c)},u);function f(t,e,n){return this.value=t,v(this,t),l.dirty_canvas=!0,!1}}}setTimeout(function(){v(this,this.value)}.bind(c),20),this.dirty_canvas=!0;break;case"toggle":"mousedown"==i.type&&(c.value=!c.value,c.callback&&setTimeout(function(){v(c,c.value)},20));break;case"string":case"text":"mousedown"==i.type&&this.prompt("Value",c.value,function(t){this.value=t,v(this,t)}.bind(c),i);break;default:c.mouse&&c.mouse(ctx,i,[o,r],t);break}return c}}function v(e,s){e.value=s,e.property&&void 0!==t.properties[e.property]&&(t.properties[e.property]=s),e.callback&&e.callback(e.value,l,t,n,i)}return null},a.prototype.drawGroups=function(t,n){if(this.graph){var i=this.graph._groups;n.save(),n.globalAlpha=.5*this.editor_alpha;for(var s=0;s<i.length;++s){var o=i[s];if(E(this.visible_area,o._bounding)){n.fillStyle=o.color||"#335",n.strokeStyle=o.color||"#335";var r=o._pos,a=o._size;n.globalAlpha=.25*this.editor_alpha,n.beginPath(),n.rect(r[0]+.5,r[1]+.5,a[0],a[1]),n.fill(),n.globalAlpha=this.editor_alpha,n.stroke(),n.beginPath(),n.moveTo(r[0]+a[0],r[1]+a[1]),n.lineTo(r[0]+a[0]-10,r[1]+a[1]),n.lineTo(r[0]+a[0],r[1]+a[1]-10),n.fill();var l=o.font_size||e.DEFAULT_GROUP_FONT_SIZE;n.font=l+"px Arial",n.fillText(o.title,r[0]+4,r[1]+l)}}n.restore()}},a.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},a.prototype.resize=function(t,e){if(!t&&!e){var n=this.canvas.parentNode;t=n.offsetWidth,e=n.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},a.prototype.switchLiveMode=function(t){if(!t)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var e=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var i=setInterval(function(){e.editor_alpha*=n,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,n<1&&e.editor_alpha<.01&&(clearInterval(i),n<1&&(e.live_mode=!0)),n>1&&e.editor_alpha>.99&&(clearInterval(i),e.editor_alpha=1)},1)},a.prototype.onNodeSelectionChange=function(t){},a.prototype.touchHandler=function(t){var e=t.changedTouches,n=e[0],i="";switch(t.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var s=this.getCanvasWindow(),o=s.document,r=o.createEvent("MouseEvent");r.initMouseEvent(i,!0,!0,s,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(r),t.preventDefault()},a.onGroupAdd=function(t,n,i){var s=a.active_canvas,o=(s.getCanvasWindow(),new e.LGraphGroup);o.pos=s.convertEventToCanvasOffset(i),s.graph.add(o)},a.onMenuAdd=function(t,n,i,s){var o=a.active_canvas,r=o.getCanvasWindow(),l=e.getNodeTypesCategories(),u=[];for(var h in l)l[h]&&u.push({value:l[h],content:l[h],has_submenu:!0});var c=new e.ContextMenu(u,{event:i,callback:p,parentMenu:s},r);function p(t,n,i){var s=t.value,a=e.getNodeTypesInCategory(s,o.filter),l=[];for(var u in a)a[u].skip_list||l.push({content:a[u].title,value:a[u].type});return new e.ContextMenu(l,{event:i,callback:d,parentMenu:c},r),!1}function d(t,n){var i=s.getFirstEvent(),r=e.createNode(t.value);r&&(r.pos=o.convertEventToCanvasOffset(i),o.graph.add(r))}return!1},a.onMenuCollapseAll=function(){},a.onMenuNodeEdit=function(){},a.showMenuNodeOptionalInputs=function(t,n,i,s,o){if(o){var r=this,l=a.active_canvas,u=l.getCanvasWindow();n=o.optional_inputs;o.onGetInputs&&(n=o.onGetInputs());var h=[];if(n)for(var c in n){var p=n[c];if(p){var d=p[0];p[2]&&p[2].label&&(d=p[2].label);var _={content:d,value:p};p[1]==e.ACTION&&(_.className="event"),h.push(_)}else h.push(null)}if(this.onMenuNodeInputs&&(h=this.onMenuNodeInputs(h)),h.length){new e.ContextMenu(h,{event:i,callback:g,parentMenu:s,node:o},u);return!1}}function g(t,e,n){o&&(t.callback&&t.callback.call(r,o,t,e,n),t.value&&(o.addInput(t.value[0],t.value[1],t.value[2]),o.setDirtyCanvas(!0,!0)))}},a.showMenuNodeOptionalOutputs=function(t,n,i,s,o){if(o){var r=this,l=a.active_canvas,u=l.getCanvasWindow();n=o.optional_outputs;o.onGetOutputs&&(n=o.onGetOutputs());var h=[];if(n)for(var c in n){var p=n[c];if(p){if(!o.flags||!o.flags.skip_repeated_outputs||-1==o.findOutputSlot(p[0])){var d=p[0];p[2]&&p[2].label&&(d=p[2].label);var _={content:d,value:p};p[1]==e.EVENT&&(_.className="event"),h.push(_)}}else h.push(null)}if(this.onMenuNodeOutputs&&(h=this.onMenuNodeOutputs(h)),h.length){new e.ContextMenu(h,{event:i,callback:g,parentMenu:s,node:o},u);return!1}}function g(t,n,i){if(o&&(t.callback&&t.callback.call(r,o,t,n,i),t.value)){var a=t.value[1];if(a&&(a.constructor===Object||a.constructor===Array)){var l=[];for(var u in a)l.push({content:u,value:a[u]});return new e.ContextMenu(l,{event:n,callback:g,parentMenu:s,node:o}),!1}o.addOutput(t.value[0],t.value[1],t.value[2]),o.setDirtyCanvas(!0,!0)}}},a.onShowMenuNodeProperties=function(t,n,i,s,o){if(o&&o.properties){var r=a.active_canvas,l=r.getCanvasWindow(),u=[];for(var h in o.properties){t=void 0!==o.properties[h]?o.properties[h]:" ";t=a.decodeHTML(t),u.push({content:"<span class='property_name'>"+h+"</span><span class='property_value'>"+t+"</span>",value:h})}if(u.length){new e.ContextMenu(u,{event:i,callback:c,parentMenu:s,allow_html:!0,node:o},l);return!1}}function c(t,e,n,i){if(o){var s=this.getBoundingClientRect();r.showEditPropertyValue(o,t.value,{position:[s.left,s.top]})}}},a.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},a.onResizeNode=function(t,e,n,i,s){s&&(s.size=s.computeSize(),s.setDirtyCanvas(!0,!0))},a.prototype.showLinkMenu=function(t,n){var i=this;function s(e){switch(e){case"Delete":i.graph.removeLink(t.id);break;default:}}return new e.ContextMenu(["Delete"],{event:n,callback:s}),!1},a.onShowPropertyEditor=function(t,e,n,i,s){var o=t.property||"title",r=s[o],l=document.createElement("div");l.className="graphdialog",l.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";var u=l.querySelector(".name");u.innerText=o;var h=l.querySelector("input");h&&(h.value=r,h.addEventListener("blur",function(t){this.focus()}),h.addEventListener("keydown",function(t){13==t.keyCode&&(g(),t.preventDefault(),t.stopPropagation())}));var c=a.active_canvas,p=c.canvas,d=p.getBoundingClientRect();d&&(d.left,d.top),event,l.style.left="100px",l.style.top="100px";var _=l.querySelector("button");function g(){f(h.value)}function f(e){"Number"==t.type?e=Number(e):"Boolean"==t.type&&(e=Boolean(e)),s[o]=e,l.parentNode&&l.parentNode.removeChild(l),s.setDirtyCanvas(!0,!0)}_.addEventListener("click",g),p.parentNode.appendChild(l)},a.prototype.prompt=function(t,e,n,i){var s=this;t=t||"";var o=!1,r=document.createElement("div");r.className="graphdialog rounded",r.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",r.close=function(){s.prompt_box=null,r.parentNode&&r.parentNode.removeChild(r)},this.ds.scale>1&&(r.style.transform="scale("+this.ds.scale+")"),r.addEventListener("mouseleave",function(t){o||r.close()}),s.prompt_box&&s.prompt_box.close(),s.prompt_box=r;var l=r.querySelector(".name");l.innerText=t;var u=r.querySelector(".value");u.value=e;var h=r.querySelector("input");h.addEventListener("keydown",function(t){if(o=!0,27==t.keyCode)r.close();else{if(13!=t.keyCode)return;n&&n(this.value),r.close()}t.preventDefault(),t.stopPropagation()});var c=r.querySelector("button");c.addEventListener("click",function(t){n&&n(h.value),s.setDirty(!0),r.close()});var p=a.active_canvas,d=p.canvas,_=d.getBoundingClientRect();return _&&(_.left,_.top),r.style.left="100px",r.style.top="100px",d.parentNode.appendChild(r),setTimeout(function(){h.focus()},10),r},a.search_limit=-1,a.prototype.showSearchBox=function(t){var n=this,i=document.createElement("div");i.className="litegraph litesearchbox graphdialog rounded",i.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>",i.close=function(){n.search_box=null,document.body.focus(),setTimeout(function(){n.canvas.focus()},20),i.parentNode&&i.parentNode.removeChild(i)};var s=null;this.ds.scale>1&&(i.style.transform="scale("+this.ds.scale+")"),i.addEventListener("mouseenter",function(t){s&&(clearTimeout(s),s=null)}),i.addEventListener("mouseleave",function(t){s=setTimeout(function(){i.close()},500)}),n.search_box&&n.search_box.close(),n.search_box=i;var o=i.querySelector(".helper"),r=null,l=null,u=null,h=i.querySelector("input");h&&(h.addEventListener("blur",function(t){this.focus()}),h.addEventListener("keydown",function(t){if(38==t.keyCode)g(!1);else if(40==t.keyCode)g(!0);else if(27==t.keyCode)i.close();else{if(13!=t.keyCode)return l&&clearInterval(l),void(l=setTimeout(f,10));u?_(u.innerHTML):r?_(r):i.close()}t.preventDefault(),t.stopPropagation()}));var c=a.active_canvas,p=c.canvas,d=p.getBoundingClientRect();function _(s){if(s)if(n.onSearchBoxSelection)n.onSearchBoxSelection(s,t,c);else{var o=e.searchbox_extras[s.toLowerCase()];o&&(s=o.type);var r=e.createNode(s);if(r&&(r.pos=c.convertEventToCanvasOffset(t),c.graph.add(r)),o&&o.data){if(o.data.properties)for(var a in o.data.properties)r.addProperty(a,o.data.properties[a]);if(o.data.inputs)for(var a in r.inputs=[],o.data.inputs)r.addOutput(o.data.inputs[a][0],o.data.inputs[a][1]);if(o.data.outputs)for(var a in r.outputs=[],o.data.outputs)r.addOutput(o.data.outputs[a][0],o.data.outputs[a][1]);o.data.title&&(r.title=o.data.title),o.data.json&&r.configure(o.data.json)}}i.close()}function g(t){var e=u;u&&u.classList.remove("selected"),u?(u=t?u.nextSibling:u.previousSibling,u||(u=e)):u=t?o.childNodes[0]:o.childNodes[o.childNodes.length],u&&(u.classList.add("selected"),u.scrollIntoView())}function f(){l=null;var t=h.value;if(r=null,o.innerHTML="",t)if(n.onSearchBox){var i=n.onSearchBox(o,t,c);if(i)for(var s=0;s<i.length;++s)f(i[s])}else{var u=0;for(var s in t=t.toLowerCase(),e.searchbox_extras){var p=e.searchbox_extras[s];if(-1!==p.desc.toLowerCase().indexOf(t)&&(f(p.desc,"searchbox_extra"),-1!==a.search_limit&&u++>a.search_limit))break}if(Array.prototype.filter){var d=Object.keys(e.registered_node_types),g=d.filter(function(e){return-1!==e.toLowerCase().indexOf(t)});for(s=0;s<g.length;s++)if(f(g[s]),-1!==a.search_limit&&u++>a.search_limit)break}else for(var s in e.registered_node_types)if(-1!=s.indexOf(t)&&(f(s),-1!==a.search_limit&&u++>a.search_limit))break}function f(t,e){var n=document.createElement("div");r||(r=t),n.innerText=t,n.dataset["type"]=escape(t),n.className="litegraph lite-search-item",e&&(n.className+=" "+e),n.addEventListener("click",function(t){_(unescape(this.dataset["type"]))}),o.appendChild(n)}}return d&&(d.left,d.top),i.style.left="100px",i.style.top="100px",p.parentNode.appendChild(i),h.focus(),i},a.prototype.showEditPropertyValue=function(t,e,n){if(t&&void 0!==t.properties[e]){n=n||{};var i="string";null!==t.properties[e]&&(i=typeof t.properties[e]),"object"==i&&t.properties[e].length&&(i="array");var s=null;if(t.getPropertyInfo&&(s=t.getPropertyInfo(e)),t.properties_info)for(var o=0;o<t.properties_info.length;++o)if(t.properties_info[o].name==e){s=t.properties_info[o];break}void 0!==s&&null!==s&&s.type&&(i=s.type);var r="";if("string"==i||"number"==i||"array"==i)r="<input autofocus type='text' class='value'/>";else if("enum"==i&&s.values){for(var o in r="<select autofocus type='text' class='value'>",s.values){var a=s.values.constructor===Array?s.values[o]:o;r+="<option value='"+a+"' "+(a==t.properties[e]?"selected":"")+">"+s.values[o]+"</option>"}r+="</select>"}else{if("boolean"!=i)return void console.warn("unknown type: "+i);r="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>"}var l=this.createDialog("<span class='name'>"+e+"</span>"+r+"<button>OK</button>",n);if("enum"==i&&s.values){var u=l.querySelector("select");u.addEventListener("change",function(t){p(t.target.value)})}else if("boolean"==i){u=l.querySelector("input");u&&u.addEventListener("click",function(t){p(!!u.checked)})}else{u=l.querySelector("input");u&&(u.addEventListener("blur",function(t){this.focus()}),u.value=void 0!==t.properties[e]?t.properties[e]:"",u.addEventListener("keydown",function(t){13==t.keyCode&&(c(),t.preventDefault(),t.stopPropagation())}))}var h=l.querySelector("button");h.addEventListener("click",c)}function c(){p(u.value)}function p(n){"number"==typeof t.properties[e]&&(n=Number(n)),"array"==i&&(n=n.split(",").map(Number)),t.properties[e]=n,t._graph&&t._graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,n),l.close(),t.setDirtyCanvas(!0,!0)}},a.prototype.createDialog=function(t,e){e=e||{};var n=document.createElement("div");n.className="graphdialog",n.innerHTML=t;var i=this.canvas.getBoundingClientRect();return i&&(i.left,i.top),e.position?(e.position[0],e.position[1]):e.event?(e.event.clientX,e.event.clientY):(.5*this.canvas.width,.5*this.canvas.height),n.style.left="100px",n.style.top="100px",this.canvas.parentNode.appendChild(n),n.close=function(){this.parentNode&&this.parentNode.removeChild(this)},n},a.onMenuNodeCollapse=function(t,e,n,i,s){s.collapse()},a.onMenuNodePin=function(t,e,n,i,s){s.pin()},a.onMenuNodeMode=function(t,n,i,s,o){function r(t){if(o)switch(t){case"On Event":o.mode=e.ON_EVENT;break;case"On Trigger":o.mode=e.ON_TRIGGER;break;case"Never":o.mode=e.NEVER;break;case"Always":default:o.mode=e.ALWAYS;break}}return new e.ContextMenu(["Always","On Event","On Trigger","Never"],{event:i,callback:r,parentMenu:s,node:o}),!1},a.onMenuNodeColors=function(t,n,i,s,o){if(!o)throw"no node for color";var r=[];for(var l in r.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"}),a.node_colors){var u=a.node_colors[l];t={value:l,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+l+"</span>"};r.push(t)}function h(t){if(o){var n=t.value?a.node_colors[t.value]:null;n?o.constructor===e.LGraphGroup?o.color=n.groupcolor:(o.color=n.color,o.bgcolor=n.bgcolor):(delete o.color,delete o.bgcolor),o.setDirtyCanvas(!0,!0)}}return new e.ContextMenu(r,{event:i,callback:h,parentMenu:s,node:o}),!1},a.onMenuNodeShapes=function(t,n,i,s,o){if(!o)throw"no node passed";function r(t){o&&(o.shape=t,o.setDirtyCanvas(!0))}return new e.ContextMenu(e.VALID_SHAPES,{event:i,callback:r,parentMenu:s,node:o}),!1},a.onMenuNodeRemove=function(t,e,n,i,s){if(!s)throw"no node passed";!1!==s.removable&&(s.graph.remove(s),s.setDirtyCanvas(!0,!0))},a.onMenuNodeClone=function(t,e,n,i,s){if(0!=s.clonable){var o=s.clone();o&&(o.pos=[s.pos[0]+5,s.pos[1]+5],s.graph.add(o),s.setDirtyCanvas(!0,!0))}},a.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},a.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:a.onMenuAdd},{content:"Add Group",callback:a.onGroupAdd}],this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},a.prototype.getNodeMenuOptions=function(t){var e=null;if(e=t.getMenuOptions?t.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:a.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:a.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:a.onShowMenuNodeProperties},null,{content:"Title",callback:a.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:a.onMenuNodeMode},{content:"Resize",callback:a.onResizeNode},{content:"Collapse",callback:a.onMenuNodeCollapse},{content:"Pin",callback:a.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:a.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:a.onMenuNodeShapes},null],t.onGetInputs){var n=t.onGetInputs();n&&n.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var i=t.onGetOutputs();i&&i.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var s=t.getExtraMenuOptions(this);s&&(s.push(null),e=s.concat(e))}return!1!==t.clonable&&e.push({content:"Clone",callback:a.onMenuNodeClone}),!1!==t.removable&&e.push(null,{content:"Remove",callback:a.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},a.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:a.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:a.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:a.onShowPropertyEditor},null,{content:"Remove",callback:a.onMenuNodeRemove}];return e},a.prototype.processContextMenu=function(t,n){var i=this,s=a.active_canvas,o=s.getCanvasWindow(),r=null,l={event:n,callback:p,extra:t},u=null;if(t&&(u=t.getSlotInPosition(n.canvasX,n.canvasY),a.active_node=t),u){r=[],u&&u.output&&u.output.links&&u.output.links.length&&r.push({content:"Disconnect Links",slot:u});var h=u.input||u.output;r.push(h.locked?"Cannot remove":{content:"Remove Slot",slot:u}),r.push(h.nameLocked?"Cannot rename":{content:"Rename Slot",slot:u}),l.title=(u.input?u.input.type:u.output.type)||"*",u.input&&u.input.type==e.ACTION&&(l.title="Action"),u.output&&u.output.type==e.EVENT&&(l.title="Event")}else if(t)r=this.getNodeMenuOptions(t);else{r=this.getCanvasMenuOptions();var c=this.graph.getGroupOnPos(n.canvasX,n.canvasY);c&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:c,options:this.getGroupMenuOptions(c)}})}if(r)new e.ContextMenu(r,l,o);function p(e,n,s){if(e)if("Remove Slot"!=e.content)if("Disconnect Links"!=e.content){if("Rename Slot"==e.content){l=e.slot;var o=l.input?t.getInputInfo(l.slot):t.getOutputInfo(l.slot),r=i.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",n),a=r.querySelector("input");a&&o&&(a.value=o.label||""),r.querySelector("button").addEventListener("click",function(t){a.value&&(o&&(o.label=a.value),i.setDirty(!0)),r.close()})}}else{var l=e.slot;l.output?t.disconnectOutput(l.slot):l.input&&t.disconnectInput(l.slot)}else{var l=e.slot;l.input?t.removeInput(l.slot):l.output&&t.removeOutput(l.slot)}}},this.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(t,e,n,i,s,o){void 0===s&&(s=5),void 0===o&&(o=s),this.moveTo(t+s,e),this.lineTo(t+n-s,e),this.quadraticCurveTo(t+n,e,t+n,e+s),this.lineTo(t+n,e+i-o),this.quadraticCurveTo(t+n,e+i,t+n-o,e+i),this.lineTo(t+o,e+i),this.quadraticCurveTo(t,e+i,t,e+i-o),this.lineTo(t,e+s),this.quadraticCurveTo(t,e,t+s,e)}),e.compareObjects=g,e.distance=f,e.colorToString=v,e.isInsideRectangle=m,e.growBounding=y,e.isInsideBounding=b,e.overlapBounding=E,e.hex2num=T,e.num2hex=w,k.prototype.addItem=function(t,e,n){var i=this;n=n||{};var s=document.createElement("div");s.className="litemenu-entry submenu";var o=!1;function r(t){var e=this.value;e&&e.has_submenu&&a.call(this,t)}function a(t){var e=this.value,s=!0;if(i.current_submenu&&i.current_submenu.close(t),n.callback){var o=n.callback.call(this,e,n,t,i,n.node);!0===o&&(s=!1)}if(e){if(e.callback&&!n.ignore_item_callbacks&&!0!==e.disabled){o=e.callback.call(this,e,n,t,i,n.extra);!0===o&&(s=!1)}if(e.submenu){if(!e.submenu.options)throw"ContextMenu submenu needs options";new i.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:i,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:n.autoopen});s=!1}}s&&!i.lock&&i.close()}return null===e?s.classList.add("separator"):(s.innerHTML=e&&e.title?e.title:t,s.value=e,e&&(e.disabled&&(o=!0,s.classList.add("disabled")),(e.submenu||e.has_submenu)&&s.classList.add("has_submenu")),"function"==typeof e?(s.dataset["value"]=t,s.onclick_callback=e):s.dataset["value"]=e,e.className&&(s.className+=" "+e.className)),this.root.appendChild(s),o||s.addEventListener("click",a),n.autoopen&&s.addEventListener("mouseenter",r),s},k.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===t?this.parentMenu.close():t&&!k.isCursorOverElement(t,this.parentMenu.root)&&k.trigger(this.parentMenu.root,"mouseleave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},k.trigger=function(t,e,n,i){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,n),s.srcElement=i,t.dispatchEvent?t.dispatchEvent(s):t.__events&&t.__events.dispatchEvent(s),s},k.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},k.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},k.isCursorOverElement=function(t,e){var n=t.clientX,i=t.clientY,s=e.getBoundingClientRect();return!!s&&(i>s.top&&i<s.top+s.height&&n>s.left&&n<s.left+s.width)},e.ContextMenu=k,e.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var n=[],i=0;i<e.length;i++)n.push(e[i]);for(var i in n)n[i].close?n[i].close():n[i].parentNode&&n[i].parentNode.removeChild(n[i])}},e.extendClass=function(t,e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);if(e.prototype)for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&(t.prototype.hasOwnProperty(n)||(e.prototype.__lookupGetter__(n)?t.prototype.__defineGetter__(n,e.prototype.__lookupGetter__(n)):t.prototype[n]=e.prototype[n],e.prototype.__lookupSetter__(n)&&t.prototype.__defineSetter__(n,e.prototype.__lookupSetter__(n))))},e.getParameterNames=function(t){return(t+"").replace(/[\/][\/].*$/gm,"").replace(/\s+/g,"").replace(/[\/][*][^\/*]*[*][\/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},Math.clamp=function(t,e,n){return e>t?e:n<t?n:t},"undefined"==typeof window||window["requestAnimationFrame"]||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(this),exports.LiteGraph=this.LiteGraph,function(t){var e=t.LiteGraph;function n(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}function i(){this.addOutput("input",""),this.addOutput("uri",""),this.addOutput("collections",""),this.name_in_graph="",this.properties={};this.widgets_up=!0,this.size=[180,60]}function s(){this.addInput("output",null),this.addInput("headers",null),this.addInput("triples",null),this.addInput("instance",null),this.addInput("attachments",null),this.addInput("uri",null),this.addInput("collections",null),this.name_in_graph="",this.properties={};this.size=[180,150]}function o(){this.addOutput("value","number"),this.addProperty("value",1),this.editable={property:"value",type:"number"}}function r(){this.size=[60,20],this.addInput("value",0,{label:""}),this.value=0}function a(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,20]}function l(){this.mode=e.ON_EVENT,this.size=[60,20],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}function u(){this.size=[60,20],this.addProperty("onExecute",""),this.addInput("in",""),this.addInput("in2",""),this.addOutput("out",""),this.addOutput("out2",""),this._func=null}n.title="Time",n.desc="Time",n.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",n),i.title="Input",i.desc="Input of the graph",i.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},i.prototype.onAction=function(t,n){this.properties.type==e.EVENT&&this.triggerSlot(0,n)},i.prototype.onExecute=function(){var t=this.graph.inputs["input"],e=this.graph.inputs["uri"],n=this.graph.inputs["collections"];this.setOutputData(0,t.value),this.setOutputData(1,e.value),this.setOutputData(2,n.value)},i.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=i,e.registerNodeType("dhf/input",i),s.title="Output",s.desc="Output of the graph",s.prototype.onExecute=function(){let t={envelope:{}};void 0==this.getInputData(0)?(t.envelope.headers=void 0!=this.getInputData(1)?this.getInputData(1):{},t.envelope.triples=void 0!=this.getInputData(2)?this.getInputData(2):{},t.envelope.instance=void 0!=this.getInputData(3)?this.getInputData(3):{},t.envelope.attachments=void 0!=this.getInputData(4)?this.getInputData(4):{},this.graph.setOutputData("output",t)):this.graph.setOutputData("output",this.getInputData(0));let e=void 0!=this.getInputData(5)?this.getInputData(5):null;this.graph.setOutputData("uri",e);let n=void 0!=this.getInputData(6)?this.getInputData(6):null;this.graph.setOutputData("collections",n)},s.prototype.onAction=function(t,n){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,n)},s.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},s.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=s,e.registerNodeType("dhf/output",s),o.title="Const",o.desc="Constant value",o.prototype.setValue=function(t){"string"==typeof t&&(t=parseFloat(t)),this.properties["value"]=t,this.setDirtyCanvas(!0)},o.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties["value"]))},o.prototype.onDrawBackground=function(t){this.outputs[0].label=this.properties["value"].toFixed(3)},e.registerNodeType("basic/const",o),r.title="Watch",r.desc="Show value of input",r.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},r.toString=function(t){if(null==t)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var e="[",n=0;n<t.length;++n)e+=r.toString(t[n])+(n+1!=t.length?",":"");return e+="]",e}return String(t)},r.prototype.onDrawBackground=function(t){this.inputs[0].label=r.toString(this.value)},e.registerNodeType("basic/watch",r),a.title="Pass",a.desc="Allows to connect different types",a.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/pass",a),l.title="Console",l.desc="Show value inside the console",l.prototype.onAction=function(t,e){"log"==t?console.log(e):"warn"==t?console.warn(e):"error"==t&&console.error(e)},l.prototype.onExecute=function(){var t=this.getInputData(1);null!==t&&(this.properties.msg=t),console.log(t)},l.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",l),u.title="Script",u.desc="executes a code",u.widgets_info={onExecute:{type:"code"}},u.prototype.onPropertyChanged=function(t,n){if("onExecute"==t&&e.allow_scripts){this._func=null;try{this._func=new Function(n)}catch(i){console.error("Error parsing script"),console.error(i)}}},u.prototype.onExecute=function(){if(this._func)try{this._func.call(this)}catch(t){console.error("Error in script"),console.error(t)}},e.registerNodeType("basic/script",u)}(this),function(global){var LiteGraph=global.LiteGraph;function StringConstant(){this.addOutput("value","xs:string"),this.string=this.addWidget("text","string","Your string",function(t){},{}),this.size=[180,60],this.serialize_widgets=!0}function featureLookupBlock(){this.addInput("lookupMap","xs:string"),this.addInput("value","xs:string"),this.addInput("searchKey","xs:string"),this.addInput("resultKey","xs:string"),this.addOutput("result","xs:string")}function currentDate(){this.size=[300,300],this.addOutput("current"),this.addProperty("currentDate","currentDate","enum",{values:currentDate.values})}function formatDateTimeAuto(t){}function formatDateAuto(t){}function docByKey(){this.addInput("id"),this.addOutput("doc","node"),this.addProperty("Template","cts.andQuery([cts.collectionQuery('/otherCollection'),cts.jsonPropertyValueQuery('theKey',${id})])")}function stringTemplate(){this.addInput("v1"),this.addInput("v2"),this.addInput("v3"),this.addOutput("newString","xs:string"),this.v5=this.addWidget("text","v4","v4",function(t){},{}),this.v6=this.addWidget("text","v5","v5",function(t){},{}),this.template=this.addWidget("text","template","${v1} ${v2} ${v3} ${v4}",function(t){},{}),this.size=[230,160],this.serialize_widgets=!0}function multicast(){this.addInput("v1"),this.addInput("v2"),this.addInput("v3"),this.addInput("v4"),this.addOutput("v1"),this.addOutput("v2"),this.addOutput("v3"),this.addOutput("v4"),this.type1=this.addWidget("combo","type1","string",function(t){},{values:["string","int","float"]}),this.type2=this.addWidget("combo","type2","string",function(t){},{values:["string","int","float"]}),this.type3=this.addWidget("combo","type3","string",function(t){},{values:["string","int","float"]}),this.type4=this.addWidget("combo","type4","string",function(t){},{values:["string","int","float"]}),this.size=[230,180],this.serialize_widgets=!0}function TestWidgetsNode(){this.addInput("clientId",null),this.addOutput("result","number"),this.properties={};this.slider=this.addWidget("slider","Last # days",365,function(t){},{min:0,max:1e3}),this.combo=this.addWidget("combo","Operation","sum",function(t){},{values:["sum","avg","min","max","count"]}),this.combo=this.addWidget("combo","Data","Amount",function(t){},{values:["TransactionDate","Amount","Discount"]}),this.size=this.computeSize(),this.serialize_widgets=!0}StringConstant.title="Constant",StringConstant.desc="Constant value",StringConstant.prototype.onExecute=function(){this.setOutputData(0,this.string.value)},LiteGraph.registerNodeType("string/constant",StringConstant),featureLookupBlock.title="Lookup",featureLookupBlock.prototype.onExecute=function(){let t=fn.head(cts.search(cts.andQuery([cts.collectionQuery(this.getInputData(0)),cts.jsonPropertyValueQuery(this.getInputData(2),this.getInputData(1))])));null!=t&&this.setOutputData(0,t.toObject()[this.getInputData(3)])},LiteGraph.registerNodeType("feature/lookup",featureLookupBlock),currentDate.values=["currentDate","currentDateTime","currentTime"],currentDate.title="Current date(time)",currentDate.desc="Outputs current date(time)",currentDate["currentDate"]={type:"enum",title:"currentDate",values:currentDate.values},currentDate.prototype.getTitle=function(){return this.properties.currentDate},currentDate.prototype.setValue=function(t){this.properties["value"]=t},currentDate.prototype.onExecute=function(){switch(this.properties.currentDate){case"currentDate":this.setOutputData(0,fn.currentDate());break;case"currentDateTime":this.setOutputData(0,fn.currentDateTime());break;case"currentTime":this.setOutputData(0,fn.currentTime());break}},currentDate.prototype.onDrawBackground=function(t){this.flags.collapsed},LiteGraph.registerNodeType("date/Current Date",currentDate),LiteGraph.wrapFunctionAsNode("date/formatDateTimeAuto",formatDateTimeAuto,["xs:string"],"xs:string"),LiteGraph.wrapFunctionAsNode("date/Format Date auto",formatDateAuto,["xs:string"],"xs:string"),docByKey.title="Get Doc by ID",docByKey.desc="Get other doc by ID",docByKey.prototype.onExecute=function(){let id=this.getInputData(0),template="`"+this.properties.Template+"`",queryStr=eval(template),query=eval(queryStr),result=fn.head(cts.search(query));this.setOutputData(0,result)},LiteGraph.registerNodeType("feature/Doc By Key",docByKey),stringTemplate.title="String Templating",stringTemplate.desc="Apply string template on inputs",stringTemplate.prototype.onExecute=function(){let v1=this.getInputData(0),v2=this.getInputData(1),v3=this.getInputData(2),v4=this.v4.value,v5=this.v5.value,template="`"+this.template.value+"`",result=eval(template);this.setOutputData(0,result)},LiteGraph.registerNodeType("string/Templating",stringTemplate),multicast.title="Multicast",multicast.desc="Cast input to type",multicast.prototype.onExecute=function(){for(let t=0;t<5;t++)if(void 0!=this.getInputData(t))switch(this["type"+t].value){case"string":this.setOutputData(t,String(this.getInputData(t)));break;case"int":this.setOutputData(t,parseInt(this.getInputData(t)));break;case"float":this.setOutputData(t,parseFloat(this.getInputData(t)));break;case"date":this.setOutputData(t,new date(this.getInputData(t)));break;default:this.setOutputData(t,this.getInputData(t))}},LiteGraph.registerNodeType("basic/multicast",multicast),TestWidgetsNode.title="Transaction stats*",LiteGraph.registerNodeType("feature/widgets",TestWidgetsNode)}(this)}).call(this,__webpack_require__("4362"))},"7bbc":function(t,e,n){var i=n("6821"),s=n("9093").f,o={}.toString,r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return s(t)}catch(e){return r.slice()}};t.exports.f=function(t){return r&&"[object Window]"==o.call(t)?a(t):s(i(t))}},"8a81":function(t,e,n){"use strict";var i=n("7726"),s=n("69a8"),o=n("9e1e"),r=n("5ca1"),a=n("2aba"),l=n("67ab").KEY,u=n("79e5"),h=n("5537"),c=n("7f20"),p=n("ca5a"),d=n("2b4c"),_=n("37c8"),g=n("3a72"),f=n("d4c0"),v=n("1169"),m=n("cb7c"),y=n("d3f4"),b=n("4bf8"),E=n("6821"),T=n("6a99"),w=n("4630"),k=n("2aeb"),O=n("7bbc"),D=n("11e9"),N=n("2621"),C=n("86cc"),I=n("0d58"),x=D.f,A=C.f,S=O.f,L=i.Symbol,P=i.JSON,M=P&&P.stringify,R="prototype",G=d("_hidden"),B=d("toPrimitive"),H={}.propertyIsEnumerable,U=h("symbol-registry"),F=h("symbols"),W=h("op-symbols"),z=Object[R],q="function"==typeof L&&!!N.f,j=i.QObject,X=!j||!j[R]||!j[R].findChild,K=o&&u(function(){return 7!=k(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,e,n){var i=x(z,e);i&&delete z[e],A(t,e,n),i&&t!==z&&A(z,e,i)}:A,Y=function(t){var e=F[t]=k(L[R]);return e._k=t,e},V=q&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},$=function(t,e,n){return t===z&&$(W,e,n),m(t),e=T(e,!0),m(n),s(F,e)?(n.enumerable?(s(t,G)&&t[G][e]&&(t[G][e]=!1),n=k(n,{enumerable:w(0,!1)})):(s(t,G)||A(t,G,w(1,{})),t[G][e]=!0),K(t,e,n)):A(t,e,n)},J=function(t,e){m(t);var n,i=f(e=E(e)),s=0,o=i.length;while(o>s)$(t,n=i[s++],e[n]);return t},Q=function(t,e){return void 0===e?k(t):J(k(t),e)},Z=function(t){var e=H.call(this,t=T(t,!0));return!(this===z&&s(F,t)&&!s(W,t))&&(!(e||!s(this,t)||!s(F,t)||s(this,G)&&this[G][t])||e)},tt=function(t,e){if(t=E(t),e=T(e,!0),t!==z||!s(F,e)||s(W,e)){var n=x(t,e);return!n||!s(F,e)||s(t,G)&&t[G][e]||(n.enumerable=!0),n}},et=function(t){var e,n=S(E(t)),i=[],o=0;while(n.length>o)s(F,e=n[o++])||e==G||e==l||i.push(e);return i},nt=function(t){var e,n=t===z,i=S(n?W:E(t)),o=[],r=0;while(i.length>r)!s(F,e=i[r++])||n&&!s(z,e)||o.push(F[e]);return o};q||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),e=function(n){this===z&&e.call(W,n),s(this,G)&&s(this[G],t)&&(this[G][t]=!1),K(this,t,w(1,n))};return o&&X&&K(z,t,{configurable:!0,set:e}),Y(t)},a(L[R],"toString",function(){return this._k}),D.f=tt,C.f=$,n("9093").f=O.f=et,n("52a7").f=Z,N.f=nt,o&&!n("2d00")&&a(z,"propertyIsEnumerable",Z,!0),_.f=function(t){return Y(d(t))}),r(r.G+r.W+r.F*!q,{Symbol:L});for(var it="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),st=0;it.length>st;)d(it[st++]);for(var ot=I(d.store),rt=0;ot.length>rt;)g(ot[rt++]);r(r.S+r.F*!q,"Symbol",{for:function(t){return s(U,t+="")?U[t]:U[t]=L(t)},keyFor:function(t){if(!V(t))throw TypeError(t+" is not a symbol!");for(var e in U)if(U[e]===t)return e},useSetter:function(){X=!0},useSimple:function(){X=!1}}),r(r.S+r.F*!q,"Object",{create:Q,defineProperty:$,defineProperties:J,getOwnPropertyDescriptor:tt,getOwnPropertyNames:et,getOwnPropertySymbols:nt});var at=u(function(){N.f(1)});r(r.S+r.F*at,"Object",{getOwnPropertySymbols:function(t){return N.f(b(t))}}),P&&r(r.S+r.F*(!q||u(function(){var t=L();return"[null]"!=M([t])||"{}"!=M({a:t})||"{}"!=M(Object(t))})),"JSON",{stringify:function(t){var e,n,i=[t],s=1;while(arguments.length>s)i.push(arguments[s++]);if(n=e=i[1],(y(e)||void 0!==t)&&!V(t))return v(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!V(e))return e}),i[1]=e,M.apply(P,i)}}),L[R][B]||n("32e9")(L[R],B,L[R].valueOf),c(L,"Symbol"),c(Math,"Math",!0),c(i.JSON,"JSON",!0)},"8b24":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"flex fixed-center"},[n("mllitegraph")],1)},s=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flex flex-center"},[n("canvas",{ref:"mycanvas",staticClass:"fixed",staticStyle:{border:"1px solid"},attrs:{width:"1200",height:"800"}}),n("q-dialog",{attrs:{persistent:""},model:{value:t.editJson,callback:function(e){t.editJson=e},expression:"editJson"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[t._v("Edit data mapping")])]),n("q-card-section",[n("q-table",{attrs:{title:"Mappings",data:t.currentProperties,columns:t.columns,"row-key":"name","binary-state-sort":""},scopedSlots:t._u([{key:"body",fn:function(e){return[n("q-tr",{attrs:{props:e}},[n("q-td",{key:"source",attrs:{props:e}},[t._v("\n                "+t._s(e.row.source)+"\n                "),n("q-popup-edit",{attrs:{title:"Update calories",buttons:""},model:{value:e.row.source,callback:function(n){t.$set(e.row,"source",n)},expression:"props.row.source"}},[n("q-input",{attrs:{type:"string",dense:"",autofocus:""},model:{value:e.row.source,callback:function(n){t.$set(e.row,"source",n)},expression:"props.row.source"}})],1)],1),n("q-td",{key:"target",attrs:{props:e}},[t._v("\n                "+t._s(e.row.target)+"\n                "),n("q-popup-edit",{attrs:{title:"Update calories",buttons:""},model:{value:e.row.target,callback:function(n){t.$set(e.row,"target",n)},expression:"props.row.target"}},[n("q-input",{attrs:{type:"string",dense:"",autofocus:""},model:{value:e.row.target,callback:function(n){t.$set(e.row,"target",n)},expression:"props.row.target"}})],1)],1)],1)]}}])})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",label:"Add mapping",color:"primary"},on:{click:function(e){return t.addMapping()}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1),n("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.savePopUpOpened,callback:function(e){t.savePopUpOpened=e},expression:"savePopUpOpened"}},[n("q-layout",{staticClass:"bg-white",attrs:{container:""}},[n("div",{staticClass:"layout-padding"},[n("q-item-label",{attrs:{header:!0}},[t._v("Save current graph")]),n("div",[n("q-input",{attrs:{"stack-label":"Graph name"},model:{value:t.graphName,callback:function(e){t.graphName=e},expression:"graphName"}})],1),n("div",{staticClass:"q-pa-sm"},[n("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:function(e){return t.saveCurrentGraph()}}}),n("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.savePopUpOpened=!1}}})],1)],1)])],1),n("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.loadPopUpOpened,callback:function(e){t.loadPopUpOpened=e},expression:"loadPopUpOpened"}},[n("q-layout",{staticClass:"bg-white",attrs:{container:""}},[n("div",{staticClass:"layout-padding"},[n("q-list",{staticClass:"q-mt-md",attrs:{link:""}},[n("q-item-label",{attrs:{header:!0}},[t._v("List of saved graph")]),t._l(t.savedGraph,function(e,i){return n("q-item",{key:e.name,attrs:{tag:"label"},nativeOn:{click:function(n){return t.getSavedGraph(e.uri)}}},[n("q-item-label",[n("q-item-section",{attrs:{label:""}},[t._v(t._s(e.name))])],1)],1)})],2),n("div",{staticClass:"q-pa-sm"},[n("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.loadPopUpOpened=!1}}})],1)],1)])],1)],1)},r=[],a=n("ea1d"),l=a["a"],u=n("2877"),h=Object(u["a"])(l,o,r,!1,null,null,null),c=h.exports,p={data:function(){return{}},components:{mllitegraph:c}},d=p,_=Object(u["a"])(d,i,s,!1,null,null,null);e["default"]=_.exports},ac4d:function(t,e,n){n("3a72")("asyncIterator")},d4c0:function(t,e,n){var i=n("0d58"),s=n("2621"),o=n("52a7");t.exports=function(t){var e=i(t),n=s.f;if(n){var r,a=n(t),l=o.f,u=0;while(a.length>u)l.call(t,r=a[u++])&&e.push(r)}return e}},ea1d:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("c47a"),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("cadf"),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("06db"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("f751"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_7__),litegraph_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("6e14"),litegraph_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(litegraph_js__WEBPACK_IMPORTED_MODULE_8__),file_saver__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("21a6"),file_saver__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_9__),_name$data$methods$cr;__webpack_exports__["a"]=(_name$data$methods$cr={name:"PageIndex",data:function(){return{editJson:!1,columns:[{name:"source",align:"left",label:"Source",field:"source",sortable:!0},{name:"target",label:"Target",field:"target",sortable:!0,align:"left"}],opened:!0,graph:null,results:null,models:[],jsonSource:{test:"test"},savePopUpOpened:!1,loadPopUpOpened:!1,graphName:"",savedGraph:[],currentProperties:[],jsoneditor:null}},methods:{registerModel:function(t){console.log("register model"),this.createBlock(t),this.models.push(t)},createBlock:function(t){console.log(t);var e=this.createGraphNodeFromModel(t);litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"].registerNodeType(t.source+"/"+t.collection,e),this.models.push(t),this.$q.notify({color:"positive",position:"top",message:"The new block is now available in the library (right click)",icon:"code"})},addMapping:function(){this.currentProperties.push({source:"val",target:"newVal"})},getSavedGraph:function(t){var e=this;this.$axios.get("/v1/resources/savedGraph?rs:uri="+encodeURI(t)).then(function(t){var n=t.data,i=!0,s=!1,o=void 0;try{for(var r,a=n.models[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var l=r.value,u=e.createGraphNodeFromModel(l);litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"].registerNodeType(l.source+"/"+l.collection,u)}}catch(h){s=!0,o=h}finally{try{i||null==a.return||a.return()}finally{if(s)throw o}}e.models=n.models,e.graph.configure(n.executionGraph)}).catch(function(){e.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})})},loadSavedGraph:function(){var t=this;this.$axios.post("/v1/resources/savedGraph").then(function(e){t.savedGraph=e.data}).catch(function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})})},createGraphNodeFromModel:function(t){var e=function(){if(this.blockDef=Object.assign({},t,{}),this.doc={input:null,output:null},this.ioSetup={inputs:{_count:0},outputs:{_count:0}},this.blockDef.options.indexOf("getByUri")>-1&&(this.ioSetup.inputs["Uri"]=this.ioSetup.inputs._count++,this.addInput("Uri","xs:string")),this.blockDef.options.indexOf("nodeInput")>-1&&(this.ioSetup.inputs["Node"]=this.ioSetup.inputs._count++,this.addInput("Node","Node")),this.blockDef.options.indexOf("nodeOutput")>-1&&(this.ioSetup.outputs["Node"]=this.ioSetup.outputs._count++,this.addOutput("Node","Node")),this.blockDef.options.indexOf("fieldsOutputs")>-1){var e=!0,n=!1,i=void 0;try{for(var s,o=t.fields[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var r=s.value;this.ioSetup.outputs[r]=this.ioSetup.outputs._count++,this.addOutput(r,"xs:string")}}catch(d){n=!0,i=d}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}if(t.options.indexOf("fieldsInputs")>-1){var a=!0,l=!1,u=void 0;try{for(var h,c=t.fields[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var p=h.value;this.ioSetup.inputs[p]=this.ioSetup.inputs._count++,this.addInput(p,"xs:string")}}catch(d){l=!0,u=d}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}this["WithInstanceRoot"]=this.addWidget("toggle","WithInstanceRoot",!0,function(t){},{on:"enabled",off:"disabled"}),this.serialize_widgets=!0};return e.title=t.collection,e.nodeType=t.collection,e},exportDHFModule:function(){console.log("export DHF module");var t=this.graph.serialize(),e={models:null!=this.models?this.models:[],executionGraph:t},n='const DataHub = require("/data-hub/5/datahub.sjs");\nconst datahub = new DataHub();\n\n\nfunction getGraphDefinition() {\n\n  return ',i="}\n\nfunction main(content, options) {\n\n  //grab the doc id/uri\n  let id = content.uri;\n\n  //here we can grab and manipulate the context metadata attached to the document\n  let context = content.context;\n\n  //let's set our output format, so we know what we're exporting\n  let outputFormat = options.outputFormat ? options.outputFormat.toLowerCase() : datahub.flow.consts.DEFAULT_FORMAT;\n\n  //here we check to make sure we're not trying to push out a binary or text document, just xml or json\n  if (outputFormat !== datahub.flow.consts.JSON && outputFormat !== datahub.flow.consts.XML) {\n    datahub.debug.log({\n      message: 'The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.',\n      type: 'error'\n    });\n    throw Error('The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.');\n  }\n\n  /*\n  This scaffolding assumes we obtained the document from the database. If you are inserting information, you will\n  have to map data from the content.value appropriately and create an instance (object), headers (object), and triples\n  (array) instead of using the flowUtils functions to grab them from a document that was pulled from MarkLogic.\n  Also you do not have to check if the document exists as in the code below.\n\n  Example code for using data that was sent to MarkLogic server for the document\n  let instance = content.value;\n  let triples = [];\n  let headers = {};\n   */\n\n  //Here we check to make sure it's still there before operating on it\n  if (!fn.docAvailable(id)) {\n    datahub.debug.log({message: 'The document with the uri: ' + id + ' could not be found.', type: 'error'});\n    throw Error('The document with the uri: ' + id + ' could not be found.')\n  }\n\n  //grab the 'doc' from the content value space\n  let doc = content.value;\n\n  // let's just grab the root of the document if its a Document and not a type of Node (ObjectNode or XMLNode)\n  if (doc && (doc instanceof Document || doc instanceof XMLDocument)) {\n    doc = fn.head(doc.root);\n  }\n\n  /*\n  //get our instance, default shape of envelope is envelope/instance, else it'll return an empty object/array\n  let instance = datahub.flow.flowUtils.getInstance(doc) || {};\n\n  // get triples, return null if empty or cannot be found\n  let triples = datahub.flow.flowUtils.getTriples(doc) || [];\n\n  //gets headers, return null if cannot be found\n  let headers = datahub.flow.flowUtils.getHeaders(doc) || {};\n\n  //If you want to set attachments, uncomment here\n  // instance['$attachments'] = doc;\n  */\n\n\n\n  //insert code to manipulate the instance, triples, headers, uri, context metadata, etc.\n\n  let gHelper  = require(\"/custom-modules/graphHelper\")\n\n  instance = gHelper.executeGraphStep(doc,id,getGraphDefinition(),context)\n\n  //form our envelope here now, specifying our output format\n // let envelope = datahub.flow.flowUtils.makeEnvelope(instance, headers, triples, outputFormat);\n\n  //assign our envelope value\n  content.value = instance.output;\n\n  //assign the uri we want, in this case the same\n  content.uri = (instance.uri!=null)?instance.uri:id;\n\ncontext.collections = (instance.collections!=null)?instance.collections:context.collections;  //assign the context we want\n  content.context = context;\n\n  //now let's return out our content to be written\n  return content;\n}\n\nmodule.exports = {\n  main: main\n};\n",s=new Blob([n+JSON.stringify(e)+i],{type:"text/plain;charset=utf-8",endings:"transparent"});Object(file_saver__WEBPACK_IMPORTED_MODULE_9__["saveAs"])(s,"main.sjs")},saveCurrentGraph:function(){var t=this,e=this.graph.serialize(),n={models:null!=this.models?this.models:[],executionGraph:e,name:this.graphName};this.$axios.put("/v1/resources/savedGraph",n).then(function(e){t.$q.notify({color:"positive",position:"top",message:"Current graph is saved",icon:"code"})}).catch(function(){t.$q.notify({color:"negative",position:"top",message:"Current graph save failed",icon:"report_problem"})})},executeGraph:function(t){var e=this;console.log("executeGraph");var n=this.graph.serialize(),i={models:null!=this.models?this.models:[],executionGraph:n};this.$axios.post("/v1/resources/executeGraph",i).then(function(t){e.results=t.data,e.$root.$emit("resultReceived",e.results),e.$q.notify({color:"positive",position:"top",message:JSON.stringify(e.results),icon:"code"})}).catch(function(){e.$q.notify({color:"negative",position:"top",message:"Graph execution failed",icon:"report_problem"})})},saveGraph:function(t){this.savePopUpOpened=!0},loadGraph:function(t){this.loadSavedGraph(),this.loadPopUpOpened=!0},DblClickNode:function(t){t&&(console.log(t),null!=t.node_over.properties&&(this.currentProperties=t.node_over.properties.mapping),this.editJson=!0,console.log(this.$refs))},registerBlocksByConf:function registerBlocksByConf(configs,LiteGraph){var code="",_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=configs[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var config=_step4.value;code+="function "+config.functionName+"(){",code+=config.inputs.map(function(t){return"this.addInput('"+t.name+(t.type?"','"+t.type+"');":"');")}).join(""),code+=config.outputs.map(function(t){return"this.addOutput('"+t.name+(t.type?"','"+t.type+"');":"');")}).join(""),code+=null!=config.properties?config.properties.map(function(t){return"this.addProperty('"+t.name+(t.type?"',"+JSON.stringify(t.type)+");":"');")}).join(""):"",code+=null!=config.widgets?config.widgets.map(function(t){return"this.addWidget('"+t.type+"','"+t.name+"','"+t.default+"', function(v){}, { values:["+JSON.stringify(t.values)+"]} );"}).join(""):"",config.width&&(code+="    this.size = ["+config.width+","+config.height+"];\n"),code+="    this.serialize_widgets = true;",code+="};",code+=config.functionName+".title = '"+config.blockName+"';",code+=config.functionName+'.prototype.onDblClick = function(e,pos,object){this.$root.$emit("nodeDblClicked",object) }.bind(this);',code+=config.functionName+".prototype.onExecute = function(){  ",null!=config.function&&null!=config.function.ref?function(){var t=0;code+="this.setOutputData( 0, "+config.function.ref+"("+config.inputs.map(function(e){return"this.getInputData("+t+++")"}).join(",")+"));"}():code+=config.function.code,code+="};",code+="LiteGraph.registerNodeType('"+config.library+"/"+config.blockName+"', "+config.functionName+" );"}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}eval(code)}},created:function(){},mounted:function(){var t=this;console.log("mounted"),this.$root.$on("registerModel",this.registerModel),this.$root.$on("executeGraphCall",this.executeGraph),this.$root.$on("saveGraphCall",this.saveGraph),this.$root.$on("loadGraphCall",this.loadGraph),this.$root.$on("exportGraphCall",this.exportDHFModule),this.$root.$on("nodeDblClicked",this.DblClickNode),this.graph=new litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"].LGraph,this.graph_canvas=new litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"].LGraphCanvas(this.$refs["mycanvas"],this.graph);litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"].createNode("basic/const");var e=[{functionName:"fn_doc",blockName:"doc",library:"fn",inputs:[{name:"uri",type:"xs:string"}],outputs:[{name:"doc",type:"node"}],function:{ref:"fn.doc",code:null}},{functionName:"fn_collection",blockName:"collection",library:"fn",inputs:[{name:"collectionName",type:"xs:string"}],outputs:[{name:"docs",type:"node()*"}],function:{ref:"fn.collection",code:null}},{functionName:"fn_baseUri",blockName:"baseUri",library:"fn",inputs:[{name:"node",type:"node"}],outputs:[{name:"uri",type:"xs:string"}],function:{ref:"fn.baseUri",code:null}},{functionName:"fn_head",blockName:"head",library:"fn",inputs:[{name:"nodes",type:null}],outputs:[{name:"node",type:null}],function:{ref:"fn.head",code:null}},{functionName:"fn_upperCase",blockName:"UpperCase",library:"string",inputs:[{name:"string",type:"xs:string"}],outputs:[{name:"STRING",type:"xs:string"}],function:{ref:"fn.upperCase",code:null}},{functionName:"fn_lowerCase",blockName:"LowerCase",library:"string",inputs:[{name:"STRING",type:"xs:string"}],outputs:[{name:"string",type:"xs:string"}],function:{ref:"fn.lowerCase",code:null}},{functionName:"fn_count",blockName:"count",library:"fn",inputs:[{name:"list",type:null}],outputs:[{name:"nbItems",type:"number"}],function:{ref:"fn.count",code:null}},{functionName:"cts_andQuery",blockName:"andQuery",library:"cts",inputs:[{name:"query1",type:"cts:query"},{name:"query2",type:"cts:query"},{name:"query3",type:"cts:query"},{name:"query4",type:"cts:query"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:null,code:"let queries = [];    if(this.getInputData(0)!=undefined) queries.push(this.getInputData(0));    if(this.getInputData(1)!=undefined) queries.push(this.getInputData(1));    if(this.getInputData(2)!=undefined) queries.push(this.getInputData(2));    if(this.getInputData(3)!=undefined) queries.push(this.getInputData(3));    this.setOutputData( 0, cts.andQuery(queries));"}},{functionName:"cts_orQuery",blockName:"orQuery",library:"cts",inputs:[{name:"query1",type:"cts:query"},{name:"query2",type:"cts:query"},{name:"query3",type:"cts:query"},{name:"query4",type:"cts:query"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:null,code:"let queries = [];    if(this.getInputData(0)!=undefined) queries.push(this.getInputData(0));    if(this.getInputData(1)!=undefined) queries.push(this.getInputData(1));    if(this.getInputData(2)!=undefined) queries.push(this.getInputData(2));    if(this.getInputData(3)!=undefined) queries.push(this.getInputData(3));    this.setOutputData( 0, cts.orQuery(queries));"}},{functionName:"cts_search",blockName:"search",library:"cts",inputs:[{name:"query",type:"cts:query"}],outputs:[{name:"results",type:"node*"}],function:{ref:"cts.search",code:null}},{functionName:"fn_stringJoin",blockName:"String join",library:"string",inputs:[{name:"string*",type:"xs:string*"}],properties:[{name:"separator",type:"xs:string"}],outputs:[{name:"joinedString",type:"xs:string"}],function:{ref:"fn.stringJoin",code:null}},{functionName:"mapValues",blockName:"Map values",library:"string",inputs:[{name:"value",type:"xs:string"}],properties:[{name:"mapping",type:[{source:"srcVal",target:"targetVal"}]}],outputs:[{name:"mappedValue",type:"xs:string"}],function:{ref:null,code:"               let val = (this.getInputData(0)!=undefined)?this.getInputData(0):'';               let mappedValue = this.properties['mapping'].filter(item => {return item.source==val});                if(mappedValue.length >0) this.setOutputData( 0,mappedValue[0].target);                                      else  this.setOutputData( 0,null);"}},{functionName:"cts_collectionQuery",blockName:"collectionQuery",library:"cts",inputs:[{name:"collectionName",type:"xs:string"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:"cts.collectionQuery",code:null}},{functionName:"json_validate",blockName:"Json (schema) validate*",library:"controls",inputs:[{name:"node",type:"node"}],outputs:[{name:"node",type:"node"}],function:{ref:null,code:null}},{functionName:"schematron_validate",blockName:"Schematron validation*",library:"controls",inputs:[{name:"doc",type:null}],outputs:[{name:"SVRL",type:"node"}],function:{ref:null,code:null}},{functionName:"isNumber",blockName:"isNumber*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"isDate",blockName:"isDate*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"isInDictionnary",blockName:"isInDictionnary*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"checkRequiredFields",blockName:"checkRequiredFields*",library:"controls",inputs:[{name:"node",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"cts_jsonPropertyValueQuery",blockName:"jsonPropertyValueQuery",library:"cts",inputs:[{name:"property",type:"xs:string"},{name:"value",type:"xs:string"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:"cts.jsonPropertyValueQuery",code:null}},{functionName:"toEnvelope",blockName:"to Envelope",library:"dhf",inputs:[{name:"headers",type:"node"},{name:"triples",type:"node"},{name:"instance",type:"node"},{name:"attachments",type:"node"}],outputs:[{name:"doc",type:"node"}],function:{ref:null,code:"let result = {'envelope' : {}} ;    if(this.getInputData(0)!=undefined) result.envelope.headers = this.getInputData(0);    if(this.getInputData(1)!=undefined) result.envelope.triples = this.getInputData(1);    if(this.getInputData(2)!=undefined) result.envelope.instance = this.getInputData(2);    if(this.getInputData(3)!=undefined) result.envelope.attachments  = this.getInputData(3);    this.setOutputData( 0, result);"}},{functionName:"fromEnvelope",blockName:"from Envelope",library:"dhf",inputs:[{name:"doc",type:"node"}],outputs:[{name:"headers",type:"node"},{name:"triples",type:"node"},{name:"instance",type:"node"},{name:"attachments",type:"node"}],function:{ref:null,code:""}},{functionName:"applyXSLT",blockName:"Apply XSLT*",library:"transform",inputs:[{name:"doc",type:"node"}],outputs:[{name:"doc",type:"node"}],function:{ref:null,code:""}},{functionName:"addProperty",blockName:"Add property",library:"transform",inputs:[{name:"doc",type:"node"},{name:"value",type:null}],properties:[{name:"propertyName",type:"Property name"}],outputs:[{name:"doc",type:"node"}],function:{ref:null,code:"let doc = (this.getInputData(0)!=undefined)?this.getInputData(0):'';                         let val = (this.getInputData(1)!=undefined)?this.getInputData(1):'';                        let propertyName = this.properties['propertyName'];                        doc[propertyName] = val;                        this.setOutputData( 0, doc);"}},{functionName:"provo",blockName:"PROV-O structure",library:"provenance",inputs:[{name:"DerivedFrom1",type:null},{name:"DerivedFrom2",type:null},{name:"DerivedFrom3",type:null},{name:"GeneratedBy",type:null},{name:"createdOn",type:null}],properties:[],outputs:[{name:"PROV-O",type:"node"}],function:{ref:null,code:"let from1 = (this.getInputData(0)!=undefined)?this.getInputData(0):null;                         let from2 = (this.getInputData(1)!=undefined)?this.getInputData(1):null;                        let from3 = (this.getInputData(1)!=undefined)?this.getInputData(2):null;                        let generatedBy = (this.getInputData(1)!=undefined)?this.getInputData(3):null;                        let createdOn = (this.getInputData(1)!=undefined)?this.getInputData(4):null;                        let doc = {derivedFrom:[]};                        if(from1) doc.derivedFrom.push(from1);                        if(from2) doc.derivedFrom.push(from2);                        if(from3) doc.derivedFrom.push(from3);                        doc.generatedBy = generatedBy;                        doc.createdOn = createdOn;                        this.setOutputData( 0, doc);"}}];this.registerBlocksByConf(e,litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"]),this.$axios.get("/statics/userblockDefs.json").then(function(e){t.registerBlocksByConf(e.data,litegraph_js__WEBPACK_IMPORTED_MODULE_8__["LiteGraph"])})}},_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_name$data$methods$cr,"created",function(){this.$root.$on("blockRequested",this.createBlock)}),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_name$data$methods$cr,"components",{}),_name$data$methods$cr)}}]);